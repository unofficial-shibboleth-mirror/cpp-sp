<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>

<head>
<title>Shibboleth Target Deployment Guide</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">

html
{	
background-color: #FFFFFF;
color: #000000;
margin: .5em;
}
a:visited
{
color: #990000;
}
a:link
{
color: #990000;
}
a:active
{
color: #440000;
}
a.fixedlink:visited
{
font-family: monospace;
font-size: 90%;
color: #121212;
text-decoration: none;
}
a.fixedlink:link
{
font-family: monospace;
font-size: 90%;
color: #121212;
text-decoration: none;
}
a.fixedlink:active
{
font-family: monospace;
font-size: 90%;
color: #121212;
text-decoration: none;
}
dl
{
border-width:2px; background-color: #DDDDDD;
background-image: url('none');
margin: 5px;
padding: 0px;
border-style: solid;
}
dt
{
background-color: #DDDDDD;
background-image: url('none');
margin: 1px;
padding: 1px
}
dd
{
background-color: #DDDDDD;
background-image: url('none');
margin: 0px;
padding: 1px
}
.attribute
{
font-size: 115%;
font-color: #000000;
text-align: left;
background-color: #DDDDDD;
border: 1px inset black;
background-image: url('none');
margin: 0px;
padding: 2px
}
.attributeopt
{
font-size: 115%;
font-color: #000000;
text-align: left;
background-color: #EEEEEE;
border: 1px inset black;
background-image: url('none');
margin: 0px;
padding: 2px
}
.value
{
font-color: #000000;
text-align: left;
background-color: #EEEEEE;
background-image: url('none');
padding-top: 0em;
padding-bottom: 0.5em;
padding-right: 1em;
padding-left: 5em;
border-bottom-width: none;
border-top-width: none;
border-left-width: 1px;
border-right-width: 1px; border-left-style:solid; border-right-style:solid; border-top-style:solid; border-bottom-style:solid
}
.mandatory
{
font-color: #000000;
background-color: #FFCCFF;
}
.demo
{
background-color: #EEEEEE;
padding: 3px;
}
.fixed
{
font-family: monospace;
font-size: 90%;
font-color: #121212;
}
.feature
{
color: #00FF00
}

    </style>
</head>

<body link="red" vlink="red" alink="black" bgcolor="white">

<center>
<h2>Shibboleth Target Deployment Guide</h2>
</center>
<p>Shibboleth Target Deployment Guide<br>
Shibboleth Version 1.2<br />
May 10, 2004<br />
<h3>This version of the deploy guide is for Shibboleth v1.2. For documentation 
related to prior versions of Shibboleth, please consult the appropriate branch 
in the Shibboleth CVS.</h3>
<h3>The default configuration of Shibboleth is <b>not</b> secure and should not be
used for protection of production content. The example private key bundled with the
distribution is publically available, widely circulated, and well-known; also, the
default federation and trust metadata is for testing purposes only. For information
about securing a Shibboleth deployment, please refer to the production guide.
Shibboleth should only be used to protect sensitive content when deployed carefully
in conjunction with proper trust settings and policies.</h3>

<p>The Shibboleth target implementation has been substantially redesigned for this release. Most of the
configuration process has changed to accomodate more complex deployments but many of the defaults work
fine for testing and simpler applications. For a list of new features, please refer to the NEWS.txt
file in the doc/ folder of the distribution.</p>

<p>Before starting, please sign up for all applicable
<a href="http://shibboleth.internet2.edu/shib-misc.html#mailinglist">mailing 
lists</a>. Announcements pertinent to Shibboleth deployments and developments 
and resources for deployment assistance can be found here.</p>
<p>Please send any questions, concerns, or eventual confusion to
<a href="mailto:shibboleth-users@internet2.edu">shibboleth-users@internet2.edu</a>. 
This should include, but not be limited to, questions about the documentation, 
undocumented problems, installation or operational issues, and anything else 
that arises.</p>
<p><br>
</p>
<hr>
<p><br>
<br>
</p>
<h3><a name="TOC"></a>Shibboleth Target -- Table of Contents</h3>
<ol type="1">
    <li>
    <h4><a href="#1."><font color="black">Shibboleth Overview</font></a></h4>
    <ol type="a">
        <li><a href="#1.a."><font color="black">Origin</font></a></li>
        <li><a href="#1.b."><font color="black">Target</font></a></li>
        <li><a href="#1.c."><font color="black">WAYF</font></a></li>
        <li><a href="#1.d."><font color="black">Federations</font></a></li>
        <li><a href="#1.e."><font color="black">Relying Parties</font></a></li>
        <li><a href="#1.f."><font color="black">Applications</font></a></li>
        <li><a href="#1.g."><font color="black">Sessions</font></a></li>
    </ol>
    </li>
    <li>
    <h4><a href="#2."><font color="black">Planning</font></a></h4>
    <ol type="a">
        <li><a href="#2.a."><font color="black">Requirements</font></a></li>
        <li><a href="#2.b."><font color="black">Join a Federation</font></a></li>
        <li><a href="#2.c."><font color="black">Security Considerations</font></a></li>
        <li><a href="#2.d."><font color="black">Server Certificates</font></a></li>
        <li><a href="#2.e."><font color="black">Attribute Release Policies</font></a></li>
        <li><a href="#2.f."><font color="black">Attribute Acceptance Policies</font></a></li>
        <li><a href="#2.g."><font color="black">Browser Requirements</font></a></li>
        <li><a href="#2.h."><font color="black">Clocks</font></a></li>
        <li><a href="#2.i."><font color="black">Other Considerations</font></a></li>
    </ol>
    </li>
    <li>
    <h4><a href="#3."><font color="black">Installation</font></a></h4>
    <ol type="a">
        <li><a href="#3.a."><font color="black">Software Requirements</font></a></li>
        <li><a href="#3.b."><font color="black">Deploy the Shibboleth Package</font></a></li>
        <li><a href="#3.c."><font color="black">Configuring Apache 1.3.x</font></a></li>
        <li><a href="#3.d."><font color="black">Configuring IIS</font></a></li>
        <li><a href="#3.e."><font color="black">Running the SHAR on Windows</font></a></li>
    </ol>
    </li>
    <li>
    <h4><a href="#4."><font color="black">Getting Running</font></a></h4>
    <ol type="a">
        <li><a href="#4.a."><font color="black">Configuring <span class="fixed">
        shibboleth.xml</span></font></a></li>
        <li><a href="#4.b."><font color="black">Dynamic Error Page Generation</font></a></li>
        <li><a href="#4.c."><font color="black">Key Generation and Certificate 
        Installation</font></a></li>
        <li><a href="#4.d."><font color="black">Protecting Web Pages</font></a></li>
        <li><a href="#4.e."><font color="black">Defining Attributes and 
        Acceptance Policies</font></a></li>
        <li><a href="#4.f."><font color="black">Using Attributes in Applications</font></a></li>
        <li><a href="#4.g."><font color="black"><span class="fixed">siterefresh</span></font></a></li>
        <li><a href="#4.h."><font color="black">MySQL Session Cache</font></a></li>
        <li><a href="#4.i."><font color="black">Using Lazy Sessions</font></a></li>
    </ol>
    </li>
    <li>
    <h4><a href="#5."><font color="black">Troubleshooting</font></a></h4>
    <ol type="a">
        <li><a href="#5.a."><font color="black">Basic Testing</font></a></li>
        <li><a href="#5.b."><font color="black">Common Problems</font></a></li>
    </ol>
    </li>
</ol>
<p><br>
</p>
<hr>
<p><br>
</p>
<h3><a name="1."></a>1. Shibboleth Overview</h3>
<p>Shibboleth is a system designed to exchange attributes across realms for the 
primary purpose of authorization. It provides a secure framework for one 
organization to transmit attributes about a web-browsing individual across 
security domains to another institution. In the primary usage case, when a user 
attempts to access a resource at a remote domain, the user&#39;s own home security 
domain can send certain information about that user to the target site in a 
trusted exchange. These attributes can then be used by the resource to help 
determine whether to grant the user access to the resource. The user may have 
the ability to decide whether to release specific attributes to certain sites by 
specifying personal Attribute Release Policies (ARP&#39;s), effectively preserving 
privacy while still granting access based on trusted information.</p>
<p>When a user first tries to access a resource protected by Shibboleth, they 
are redirected to a service which asks the user to specify the organization from 
which they want to authenticate. If the user has not yet locally authenticated 
to a WebISO service, the user will then be redirected to their home 
institution&#39;s authentication system. After the user authenticates, the 
Shibboleth components at the local institution will generate a temporary 
reference to the user, known as a handle, for the individual and send this to 
the target site. The target site can then use the handle to ask for attributes 
about this individual. Based on these attributes, the target can decide whether 
or not to grant access to the resource. The user may then be allowed to access 
the requested materials.</p>
<p>There are several controls on privacy in Shibboleth, and mechanisms are 
provided to allow users to determine exactly which information about them is 
released. A user&#39;s actual identity isn&#39;t necessary for many access control 
decisions, so privacy often is needlessly compromised. Instead, the resource 
often utilizes other attributes such as faculty member or member of a certain 
class. While these are commonly determined using the identity of the user, 
Shibboleth provides a way to mutually refer to the same principal without 
revealing that principal&#39;s identity. Because the user is initially known to the 
target site only by a randomly generated temporary handle, if sufficient, the 
target site might know no more about the user than that the user is a member of 
the origin organization. This handle should never be used to decide whether or 
not to grant access, and is intended only as a temporary reference for 
requesting attributes.</p>
<h4><a name="1.a."></a>1.a. Origin</h4>
<blockquote>
    <p>There are four primary components to the origin side in Shibboleth: the 
    Attribute Authority (AA), the Handle Service (HS), the directory service, 
    and the local sign-on system (SSO). The AA and HS are provided with 
    Shibboleth, and an open-source WebISO solution Pubcookie is also supplied; 
    the directory is provided by the origin site. Shibboleth is able to 
    interface with a directory exporting an LDAP interface or a SQL database 
    containing user attributes, and is designed such that programming interfaces 
    to other repositories should be readily implemented. Shibboleth relies on 
    standard web server mechanisms to trigger local authentication. A .htaccess 
    file can be easily used to trigger either the local WebISO system or the web 
    server&#39;s own Basic Auth mechanism, which will likely utilize an enterprise 
    authentication system, such as Kerberos.</p>
    <p>From the origin site&#39;s point of view, the first contact will be the 
    redirection of a user to the handle service, which will then consult the SSO 
    system to determine whether the user has already been authenticated. If not, 
    then the browser user will be asked to authenticate, and then sent back to 
    the target URL with a handle bundled in an attribute assertion. Next, a 
    request from the Shibboleth Attribute Requester (SHAR) will arrive at the AA 
    which will include the previously mentioned handle. The AA then consults the 
    ARP&#39;s for the directory entry corresponding to the handle, queries the 
    directory for these attributes, and releases to the SHAR all attributes the 
    SHAR is entitled to know about that user.</p>
</blockquote>
<h4><a name="1.b."></a>1.b. Target</h4>
<blockquote>
    <p>There are three primary components to the target side in Shibboleth: the 
    Shibboleth Indexical Reference Establisher (SHIRE), the Shibboleth Attribute 
    Requester (SHAR), and the resource manager (RM). An implementation of each 
    of these is included in the standard Shibboleth distribution. These 
    components are intended to run on the same web server.</p>
    <p>From the target&#39;s point of view, a browser will hit the RM with a request 
    for a Shibboleth-protected resource. The RM then allows the SHIRE to step 
    in, which will use the WAYF to acquire the name of a handle service to ask 
    about the user. The handle service (HS) will then reply with a SAML 
    authentication assertion containing a handle, which the SHIRE then hands off 
    to the SHAR. The SHAR uses the handle and the supplied address of the 
    corresponding attribute authority (AA) to request all attributes it is 
    allowed to know about the handle. The SHAR performs some basic validation 
    and analysis based on attribute acceptance policies (AAP&#39;s). These 
    attributes are then handed off to the RM, which is responsible for using 
    these attributes to decide whether to grant access.</p>
</blockquote>
<h4><a name="1.c."></a>1.c. Where are you from? (WAYF)</h4>
<blockquote>
    <p>The WAYF service can be either outsourced and operated by a federation or 
    deployed as part of the SHIRE. It is responsible for allowing a user to 
    associate themself with an institution of their specification, then 
    redirecting the user to the known address for the handle service of that 
    institution.</p>
</blockquote>
<h4><a name="1.d."></a>1.d. Federations</h4>
<blockquote>
    <p>A federation is one way to provide part of the underlying trust required 
    for function of the Shibboleth architecture. A federation in the context of 
    Shibboleth is a group of organizations(universities, corporations, content 
    providers, etc.) who agree to exchange attributes using the SAML/Shibboleth 
    protocols and abide by a common set of policies and practices. In so doing, 
    they must implicitly or explicitly agree to a common set of guidelines. 
    Joining a federation is not explicitly necessary for operation of 
    Shibboleth, but it dramatically expands the number of targets and origins 
    that can interact without defining bilateral agreements between all these 
    parties.</p>
    <p>A federation can be created in a variety of formats and trust models, but 
    to support Shibboleth, it must provide a certain set of services to 
    federation members. It needs to supply a registry to process applications to 
    the federation and distribute membership information to the origin and 
    target sites. This must include distribution of the PKI components necessary 
    for trust between origins and targets. There also needs to be a set of 
    agreements and best practices defined by the federation governing the 
    exchange, use, and population of attributes before and after transit, and 
    there should be a way to find information on local authentication and 
    authorization practices for federation members.</p>
</blockquote>
<h4><a name="1.e."></a>1.e. Relying Parties</h4>
<blockquote>
    <p>Some aspects of both origin and target configuration can vary and be
    expressed in terms of the &quot;relying party&quot;. To an origin, a target
    is a relying party, while targets consider origins to be relying
    parties (it's a matter of perspective). Certificates, policies, and
    other aspects of an interaction are specified on the basis of the relying
    party, and may or may not vary between relying parties depending on the
    deployment's needs.</p>
    <p>Each origin and target is assigned a URI, a unique identifier to enable
    control over configuration down to the level of an individual partner (a single
    relying party). By convention, this is termed a &quot;providerId&quot;. More
    frequently, an entire federation will be viewed by an origin or target as a
    single relying party to simplify management. An individual origin or target
    with which this deployment exchanges information may sometimes be part of
    multiple relying parties if there are multiple trust agreements
    under which these transactions are performed. Care should be taken to avoid
    conflicting or inconsistent configuration in such cases.</p>
</blockquote>
<h4><a name="1.f."></a>1.f. Applications</h4>
<blockquote>
    <p>Shibboleth &quot;applications&quot; are the primary unit of target
    configuration. Applications as viewed by the target implementation
    are not necessarily defined by the same metrics as in other contexts.  An
    individual application represents a set of web resources that operates
    using the same attribute handling and trust configuration and shares a common
    <a href="#1.g.">session</a> with the browser user. As a user navigates between
    resources on a server that cross an application boundary, a new session is
    established, though user interaction may not be required. As a consequence of
    the relationship between applications and sessions (which are tracked with
    a cookie), an application usually does not span more than one virtual host.
    Apart from cookie-based constraints, web resources can be aggregated into
    applications in arbitrary ways.</p>
    <p>A single target deployment may support a large number of applications,
    but it need not register or publish information about each one with the
    origins it accepts information from. Instead it can communicate using a
    more limited set of distinct &quot;providerId&quot; values (often just a
    single one). This allows targets with a complex internal configuration
    to be treated as a single entity by origins for the purposes of attribute
    release.</p>
</blockquote>
<h4><a name="1.g."></a>1.g. Sessions</h4>
<blockquote>
    <p>Much of the target implementation is concerned with establishing, and
    subsequently maintaining, sessions with the browser user on behalf of the
    <a href="#1.f.">applications</a> at the target. A session consists of a
    cookie passed between the browser and web server, associated with a
    security context. The context contains the user's authentication information,
    and generally a set of attributes that make up the user's identity. Each
    application maintains distinct sessions with the browser by means of separate
    cookies. It is important to note that all such sessions are independent and
    distinct: any session can exist with or without any other session, and the
    expiration of any one session does not imply the expiration of any other
    session.  Shibboleth also does not support any logout functionality beyond the
    termination of individual application sessions by deletion of respective
    cookies; also, there is no way for the target to cause origin-side sessions,
    such as a user's SSO login, to expire.</p>
    <p>A browser user accessing a Shibboleth-protected resource may have two
    outcomes: standard session establishment, and lazy session
    establishment.  The standard session establishment mechanism in which
    Shibboleth protects the resource in all circumstances results in the
    establishment of a cookie-based browser session and a set of attributes
    cached for that application. Shibboleth 1.2 also supports so-called lazy
    session establishment, in which the resource may be accessed without prior
    authentication.  This means the application must be intelligent enough to
    determine whether authentication is necessary, and then construct the proper URL
    to initiate a browser redirect to request authentication; if the
    application determines none is necessary or uses other authorization
    mechanisms, then the request for authentication may not need to be triggered.
    This complex functionality is mostly useful to protect a single URL with
    different access mechanisms, or to require authenticated access only in
    instances where the application deems it necessary.</p>
    <p>Independently of this, a web-based application protected by Shibboleth
    may have a need to establish its own session with the user.  This session
    may persist well beyond the Shibboleth session, and logouts from this
    session, if supported, will not terminate a Shibboleth session initiated to
    access the resource.  Application administrators should carefully evaluate
    the expiration of all sessions to limit vulnerability to attacks or user
    negligence. Logging out of the entire desktop session is usually the
    only (relatively) foolproof logout mechanism on the web.</p>
</blockquote>
<hr>
<h3><a name="2."></a>2. Planning</h3>
<p>There are several essential elements that must be present in the environment 
to ensure Shibboleth functions well, both political and technical. Shibboleth 
currently runs on a specific range of platforms and web server environments. The 
SHAR and SHIRE are implemented entirely in C/C++. These are the recommendations 
and requirements for a successful implementation of a Shibboleth target.</p>
<h4><a name="2.a."></a>2.a. Requirements</h4>
<blockquote>
    <p>Shibboleth currently supports Windows NT/2000/XP/2003, Linux, and 
    Solaris. At present, Shibboleth consists of Apache (or IIS) plugins and a 
    separate SHAR process. The plugins use the Sun/ONC RPC mechanism to communicate 
    with the SHAR over Unix domain or TCP sockets. The target&#39;s web servers must 
    be running <a href="http://http://www.apache.org/dist/httpd/">Apache</a> 
    1.3+, 2.0+, or Microsoft IIS 4.0+ More precise technical 
    details are discussed in <a href="#3.a.">3.a</a>.</p>
</blockquote>
<h4><a name="2.b."></a>2.b. Join a Federation</h4>
<blockquote>
    <p>While it is not necessary for a target or origin to join a federation, 
    doing so greatly facilitates the implementation of multilateral trust 
    relationships. Each federation will have a different application process.</p>
    <p>For more information on federations, refer to <a href="#1.d.">1.d</a> or 
    the Shibboleth v1.0 architectural document.</p>
    <p>For testing in a private environment, Shibboleth comes with a default
    configuration that demonstrates how to implement a local peered agreement
    and supports testing both origin and target on the same box using localhost
    URLs. The sample key and certificate is for ease of testing only, and should
    always be replaced for real world use.</p>
</blockquote>
<h4><a name="2.c."></a>2.c. Security Considerations</h4>
<blockquote>
    <p>Shibboleth&#39;s protocols and software have been extensively engineered to 
    provide protection against many attacks. However, the most secure protocol 
    can be compromised if it is placed in an insecure environment. To ensure 
    Shibboleth is as secure as possible, there are several recommended security 
    precautions which should be in place at local sites.</p>
    <ol type="i">
        <li>SSL use is optional for target sites, but should be used if at all 
        possible, at least in the processing of incoming sessions (called the 
        SHIRE URL or assertion consumer service). Federation guidelines should 
        be considered when determining whether to implement SSL, and, in 
        general, SSL should be used for interactions with client machines to 
        provide the necessary authentication and encryption to ensure protection 
        from man-in-the-middle attacks. It is strongly suggested that all 
        password traffic or similarly sensitive data should be SSL-protected. 
        Assessment of the risk tradeoff against possible performance degradation 
        should be performed for all applications.</li>
        <li>Many other attacks can be made on the several redirection steps that 
        Shibboleth takes to complete attribute transfer. The best protection 
        against this is safeguarding the WAYF service and ensuring that rogue 
        targets and origins are not used, generally by development of the trust 
        model underneath Shibboleth. Shibboleth also leverages DNS for security, 
        which is not uncommon, but attacks concerning domain name lookups
        should be considered.</li>
        <li>Information regarding origin users is generally provided by the 
        authoritative enterprise directory, and the acceptance of requests from 
        target applications can be carefully restricted to ensure that all 
        requests the SHAR performs are authorized and all information the origin 
        provides is accurate. Proper security measures should also be in place 
        on directory access and population(see
        <a href="http://www.georgetown.edu/giia/internet2/ldap-recipe/#AccessControl">
        Access Control</a> in the
        <a href="http://www.georgetown.edu/giia/internet2/ldap-recipe/">LDAP 
        recipe</a> for more information). Use of plaintext passwords is strongly 
        advised against.</li>
        <li>Server platforms should be properly secured, commensurate with the 
        level that would be expected for an organization&#39;s other security 
        services, and cookie stores on client machines should be well protected.</li>
    </ol>
</blockquote>
<h4><a name="2.d."></a>2.d. Server Certs</h4>
<blockquote>
    <p>In the Shibboleth architecture, the origin and target software must all have 
    various client and/or server certificates for use in signing assertions and 
    creating SSL connections These should be issued by a commonly accepted CA, 
    which may be stipulated by your federation. After understanding the CA&#39;s 
    acceptible to your federations, consult chapter <a href="#4.c.">4.c</a> for 
    information on certificate and key generation.</p>
</blockquote>
<h4><a name="2.e."></a>2.e. Attribute Release Policies</h4>
<blockquote>
    <p>The Attribute Authority maintains a set of policies called Attribute 
    Release Policies (or ARP&#39;s) that govern the sharing of user attributes with 
    Shibboleth target sites. When a user attempts to access a 
    Shibboleth-protected resource, that resource&#39;s SHAR queries the user&#39;s AA 
    for all attributes to which it is entitled. The SHAR provides its own name 
    and the URI of the requesting application. The 
    AA finds the attributes associated with the browser user, determines an 
    &quot;Effective ARP&quot; for this user, and then sends to the SHAR only the 
    attribute-value pairs allowed in this policy.</p>
    <p>An ARP may be thought of as a sort of filter for outbound attributes; it 
    cannot create attributes or data that aren&#39;t originally present, but it can 
    limit the attributes released and the values those attributes may have when 
    released. It does not change the information in the data sources in any way.</p>
    <p>Each ARP is comprised of one or more rules that specify which attributes
    and values may be released to a given application and that SHAR. The
    assignment of rules to various targets is quite flexible and includes
    mechanisms for specifying: that a rule should affect all targets (default
    rule), exact SHAR names for which a rule is applicable, regular expressions
    against which SHAR names should be matched to determine if a rule is
    applicable, and individual applications that may span hosts and URL's as
    necessary.</p>
    <p>For each request, an Effective ARP is determined by locating all ARP&#39;s 
    applicable to the designated user and extracting each rule that matches the 
    querying SHAR and resource. Attributes and values that are specified for 
    release are included in the effective ARP, while those specified for denial 
    are blocked from release. See section <a href="#5.b.i.">5.b.i</a> for 
    details on how ARP&#39;s are processed.</p>
    <p>Various ARP&#39;s may be combined in forming the Effective ARP. For instance, 
    the Site ARP is administratively maintained and applies to all users for 
    which the AA is answerable. User ARP&#39;s apply to a specific user only, and 
    can be maintained either administratively or by the users themselves. All 
    ARP&#39;s are specified using the same syntax and semantics.</p>
</blockquote>
<h4><a name="2.f."></a>2.f. Attribute Acceptance Policies</h4>
<blockquote>
    <p>When a target receives a set of attributes, it must evaluate them in the 
    context of the Attribute Authority that is providing them, to assess their 
    &quot;reasonableness&quot;. For example, if the value of an attribute is expected to 
    be from a small set of enumerated choices, the value should be compared 
    against that list. If a particular attribute or value is only trusted when 
    asserted by specific origins, that too should be checked.</p>
    <p>Targets are configured to accept specific attributes that they understand 
    and care about, and are also configured with the rules to apply before 
    accepting the attributes for use by the RM or an application. Attributes and 
    values that don&#39;t meet the target&#39;s requirements are filtered out. The set 
    of configuration rules to make these decisions is called an Attribute 
    Acceptance Policy (AAP).</p>
</blockquote>
<h4><a name="2.g."></a>2.g. Browser Requirements</h4>
<blockquote>
    <p>A primary Shibboleth design consideration was to require very little or 
    no modification to client machines. The only requirement is that a browser 
    is used which supports cookies, redirection and SSL. Browser users will have 
    to perform an additional click to submit the authentication assertion if 
    JavaScript is not functional.</p>
</blockquote>
<h4><a name="2.h."></a>2.h. Clocks</h4>
<blockquote>
    <p><a href="http://www.ntp.org/">NTP</a> should be run on all 
    web servers. Shibboleth employs a short assertion acceptance window to protect 
    against replay attacks. Because of this, any significant degree of clock 
    skew can hinder the ability of users to access sites successfully.</p>
</blockquote>
<h4><a name="2.h."></a>2.i. Other Considerations</h4>
<blockquote>
    <p>Especially for higher education, there are a handful of laws enacted 
    which may have important ramifications on the disclosure of personal 
    information and attributes. Since Shibboleth does not necessarily need to 
    transmit identity, it is an ideal solution for many higher education 
    situations. Nevertheless, all parties within the United States of America 
    are strongly advised to consult the
    <a href="http://www.ed.gov/offices/OM/fpco/ferpa/">Family Educational Rights 
    and Privacy Act of 1974(FERPA)</a>, and all other relevant state and federal 
    legislation before deploying Shibboleth.</p>
</blockquote>
<hr>
<h3><a name="3."></a>3. Installation</h3>
<h4><a name="3.a."></a>3.a. Software Requirements</h4>
<p>The Shibboleth project makes binary packages available only for Windows,
that are precompiled against recent releases of various required libraries such 
as OpenSSL. Binaries for other platforms may be available on a limited or ad hoc
basis. It is highly advisable to build from source when using Shibboleth in 
a production environment in order to permit patching or updating of packages as 
security holes and bugs are fixed. Building from source is necessary to give you 
complete control over your deployment platform. The binary packages represent a 
snapshot in time only. To build from source, see the <span class="fixed">
INSTALL.txt</span> files in the doc folder of the OpenSAML and Shibboleth source 
distributions.</p>
<p>The software requirements listed correspond to the binary distribution. In 
general, source builds should work against all recent versions of the operating 
systems and software dependencies listed below. For specific questions, inquire 
to the support mailing list, or give it a try. Note that OpenSSL releases 
frequent security updates; the version listed may not be the most current, but 
most minor &quot;letter&quot; updates should be usable.</p>
<blockquote>
    <p><b>General Requirements and Notes:</b></p>
    <ul type="circle">
        <li><a href="http://www.apache.org/dist/httpd/">Apache 1.3.x</a>
        <blockquote>
            <p>Apache 1.3.x must be compiled with mod_so for DSO module support, and
            should include SSL support (preferably using <span class="fixed">mod_ssl</span>),
            and EAPI support (which <span class="fixed">mod_ssl</span> requires and provides).</p>
            <p><b>Portions of the <span class="fixed">libphp4</span> Apache 
            module are written in C++, as is Shibboleth. There is a known conflict on Unix
            platforms between the PHP extensions <span class="fixed">libpspell.so</span> 
            and <span class="fixed">libsablot.so</span> which will manifest 
            itself as segmentation faults when starting Apache. If a site wants 
            to use <span class="fixed">libphp4.so</span> and Shibboleth at the same time, 
            then one of the following may be done:</b></p>
            <ol>
                <li>Remove the options <span class="fixed">--with-pspell</span> 
                and <span class="fixed">--with-xslt-sablot</span> from PHP&#39;s 
                configuration.</li>
                <li>Rebuild these two modules using the same version of GCC that 
                was used to compile Shibboleth.</li>
            </ol>
        </blockquote>
        </li>
        <li><a href="http://www.apache.org/dist/httpd/">Apache 2.0.x</a>
        <blockquote>
            <p>Apache 2.0.x must be compiled with mod_so for DSO module support, and
            should include SSL support which is available but not included by default.
            See also the note about PHP above.</p>
        </blockquote>
        </li>
        <li>IIS 4.0+
            <blockquote>
            <p>When installing under Windows 2003, if the server is not in a
            domain before installing IIS 6, there may be issues surrounding
            permissions on directories because of new restrictions on IIS
            extensions accessing files.</p>
            </blockquote>
        </li>
        <li><a href="http://www.openssl.org">OpenSSL</a>
        <blockquote>
            <p>Verions 0.9.6 and 0.9.7 are both supported, but 0.9.7 should be used
            if possible, as support for 0.9.6 may be dropped in a future release.
            Support for threads and shared libraries <b>must</b> be included during
            configuration using the <i>threads</i> and <i>shared</i> options.</p>
        </blockquote>
        </li>
        </ul>
    <p>Most other required libraries are either easy to update or not found on
    typical systems. See the <span class="fixed">INSTALL.txt</span> files in the
    OpenSAML and Shibboleth source distributions for specific requirements of a
    given release. The important requirements are for pthreads support and
    shared libraries on Unix platforms. Without both, building will be hard and
    stability unlikely.</p>
    <p><b>Operating System Specific Notes:</b></p>
    <ul type="circle">
        <li>Windows NT/2000/XP/2003
            <ul type="disc">
                <li>
                <p>Any Apache modules used, and Apache itself, must be compiled 
                with the Microsoft DLL-based runtime, selected by compiling with 
                the /MD switch. The binary distribution was built against Apache
                versions 1.3.29 (with EAPI patches from mod_ssl 2.8.16) and 2.0.48.
                Forward compatibility is likely, but errors will result if an
                Apache implementation such as IBM's IHS product or any other
                non-EAPI version of 1.3 is used. In such cases, you must build
                the Shibboleth Apache modules from source.</p>
                </li>
                <li>
                <p>The installer will prompt for an install path, change default 
                configuration files as appropriate for Windows, and set various 
                environment variables for you. A default SHAR service can also 
                be installed, or you can install it manually using the 
                instructions in this guide.</p>
                <p>Note that debug/symbol versions of the libraries and software 
                are included, and may be used by appending &quot;debug&quot; to the 
                Shibboleth library path and using the corresponding modules and 
                binaries. If you do so, be aware that Apache and other modules 
                must also be compiled with Microsoft&#39;s debug runtime (via the /MDd 
                compiler option). In most cases, you can safely ignore or even 
                delete the debug versions.</p>
                </li>
            </ul>
        </li>
        <li>RedHat Linux 7.2,7.3:
            <ul type="disc">
            <li>
                <p>The most recent Red Hat RPM for Apache (1.3.27-2 as of this writing) is sufficient for
                use with Shibboleth. You can use the older version of OpenSSL included with the OS, for this
                release, but be advised this may change in the future.</p>
            </li>
            <li>
                <p>The version of GCC that comes with this system is too old to build Shibboleth.
                Special update RPMs are available for GCC 3.04 that will work provided you
                configure packages with CC and CXX set to gcc3 and g++3 respectively. Newer
                GCC versions also work but may require a glibc upgrade and necessitate a lot
                of unrelated package updates.</p>
            </li>
            </ul>
        </li>
        <li>RedHat Linux 9 / Fedora
            <ul type="disc">
            <li>
                <p>Apache 2.0 is included as the default Apache version in this release.</p>
            </li>
            </ul>
        </li>
        <li>RedHat Enterprise Linux
            <ul type="disc">
            <li>
                <p>Apache 2.0 is included as the default Apache version in this release.</p>
            </li>
            </ul>
        </li>
        <li>Debian Linux
            <ul type="disc">
            <li>
                <p>Shibboleth requires that Apache and Apache-SSL be built with
                <span class="fixed">libpthread</span>, or loading the
                <span class="fixed">mod_shib_13</span> or <span class="fixed">mod_shib_20</span>
                modules will cause Apache to fail. While RedHat&#39;s Apache is compatible,
                Debian&#39;s Apache must be rebuilt with <span class="fixed">libpthread</span>:</p>
                <blockquote>
                    <p><span class="fixed">$ export LDFLAGS=-lpthread<br>
                    $ apt-build --rebuild --reinstall install \<br>
&nbsp;&nbsp;&nbsp; apache-common apache apache-ssl</span></p>
                </blockquote>
            </li>
            </ul>
        </li>
        <li>Solaris 2.6+:
            <ul type="disc">
            <li>
                <p>The shared library version of OpenSSL is required by 
                Shibboleth. The static libraries may be installed as well if 
                necessary for other applications, but cannot be linked into
                mod_ssl or any other Apache modules. If mod_ssl's libssl.so
                module is linked against the static version, bus errors will
                result.</p>
                <p>To check how mod_ssl was built, run the <span class="fixed">
                ldd</span> command against <span class="fixed">libssl.so</span> 
                in the Apache <span class="fixed">libexec/</span> folder and 
                check the output for references to <span class="fixed">
                libssl.so.0.9.7</span>. If you see an earlier version 
                mentioned, or no mention of it at all, then OpenSSL 0.9.7 must be
                built with shared libraries from source, and the Apache module rebuilt with it.</p>
                <p>openssl-0.9.7d, the latest security fix release, has been tested,
                but any 0.9.7 version should work.</p>
            </li>
            <li>
                <p>Solaris does not come with GCC 3, but various versions can be obtained
                from <a href="http://www.sunfreeware.com">http://www.sunfreeware.com</a>.
                If building your own, GCC must be configured to use Sun's linker. Note that
                you should use a consistent version of GCC across any other C++ libraries
                in use within Apache, but other C++ code on your server can freely use a
                different version as long as the necessary <span class="fixed">libstdc++.so</span>
                for a given version is available</p>
            </li>
            <li>
                <p>Use of GCC is recommended, but new releases of Sun's Forte compiler have
                been used successfully with some tinkering with configuration scripts.</p>
            </li>
        </ul>
        </li>
    </ul>
</blockquote>
<h4><a name="3.b."></a>3.b. Deploy the Shibboleth Package</h4>
<blockquote>
    <p>For the sake of clarity, this deployment guide assumes that standard 
    directories are used for all installations. These directories may be changed 
    for local implementations, but must be done so consistently.</p>
    <p>On Unix, the build documentation suggests building into
    <span class="fixed">/opt/shibboleth</span>. If you use a different layout or
    location, most of the essential configuration files will be tweaked for you,
    but watch for any exceptions.</p>
    <p>On Windows, use of the installer is recommended. Visual Studio 6.0
    project files are included with the OpenSAML and Shibboleth source
    distributions for source builds if maximum flexibility to deal with
    security issues or Apache variants is desired.</p>
</blockquote>
<h4><a name="3.c."></a>3.c. Configure Apache</h4>
<blockquote>
    <ol type="1">
        <li>Shibboleth includes configuration directives in the files
        <span class="fixed">/opt/shibboleth/etc/shibboleth/apache.config</span> 
        and <span class="fixed">/opt/shibboleth/etc/shibboleth/apache2.config</span>
        which must be added to the <span class="fixed">httpd.conf</span> file used
        locally. It is recommended that these directives simply be added to the end of the 
        existing <span class="fixed">httpd.conf</span> file rather than trying 
        to merge it in-line; <a href="#3.c.2.">step 2</a> describes the 
        necessary modifications to the Apache startup script. The default 
        configuration will often work, but if customization is necessary, these 
        options may be modified:<dl>
            <dd class="attribute"><span class="fixed">LoadModule &lt;module&gt; &lt;pathname&gt;</span></dd>
            <dd class="value">Specifies the name and location of the module,
            installed by default at <span class="fixed">/opt/shibboleth/libexec/mod_shib_13.so</span>
            or <span class="fixed">/opt/shibboleth/libexec/mod_shib_20.so</span></dd>
            
            <dd class="attribute"><span class="fixed">ShibConfig &lt;pathname&gt;</span></dd>
            <dd class="value">Specifies the <span class="fixed">pathname</span> 
            of the Shibboleth configuration file. Defaults to <span class="fixed">
            /opt/shibboleth/etc/shibboleth/shibboleth.xml</span>.</dd>
            
            <dd class="attribute"><span class="fixed">ShibSchemaDir &lt;path&gt;</span></dd>
            <dd class="value">Specifies the <span class="fixed">path</span> 
            of the Shibboleth schema folder. Defaults to <span class="fixed">
            /opt/shibboleth/etc/shibboleth</span>.</dd>
            
            <dd class="attribute"><span class="fixed">&lt;Location <i>url</i>&gt;<br>
            &nbsp;&nbsp;SetHandler &lt;method&gt;<br>
            &lt;/Location&gt;</span></dd>
            <dd class="value"><p>(Apache 1.3 only) Specifies the relative <span class="fixed">path</span>
            and the <span class="fixed">handler</span> the target uses to process 
            incoming sessions and lazy session startup for Shibboleth-protected
            resources. This works in concert with the <span class="fixed">shireURL</span>
            settings in the XML configuration file. Any virtual locations that are to be
            used for this purpose should be defined to Apache here.</p>
            <p>Another option for some sites is to configure Shibboleth globally in
            &quot;lazy&quot; session mode for all content. This allows the module to
            detect session requests and pass them to the handler without the need to
            configure the handler itself.</p>
            </dd>
        </dl>
        </li>
        <li>If the OpenSSL libraries are not in the system&#39;s search path, they 
        should be added to the <span class="fixed">LD_LIBRARY_PATH</span> used by
        Apache. You will also usually need to add <span class="fixed">/opt/shibboleth/lib</span>
        to <span class="fixed">LD_LIBRARY_PATH</span> as well.</li>
        <li>The SHAR must be started along with Apache. Among other methods on 
        Unix, this can be done either by creating a separate SHAR startup script 
        or by modifying Apache&#39;s RC script to start/stop the <span class="fixed">
        SHAR</span> <b>before</b> <span class="fixed">httpd</span>. It is 
        suggested that Apache&#39;s script be modified by adding:<blockquote>
            <p><span class="fixed">/opt/shibboleth/bin/shar -f &amp;</span> </p>
        </blockquote>
        <p>In most cases, the build process insures that the SHAR can locate
        the configuration file and schemas, but the SHIBCONFIG and SHIBSCHEMAS
        environment variables may be used as well. Command line options can also
        be used to specify them.</p>
        <p>On Windows, the SHAR is a service and is managed separately.</li>
        <li>By default, the Shibboleth modules are configured to log information
        on behalf of Apache to the file <span class="fixed">
        /opt/shibboleth/var/log/shibboleth/shire.log</span>, though this can be
        changed by modifying the <span class="fixed">.logger</span> files
        pointed to by <a href="#4.a.">configuration elements</a>. For this log
        to be created, Apache must have permission to write to this file, which
        may require that the file be manually created and permissions assigned
        to whatever user Apache is configured to run under. If the file does not
        appear when Apache runs with the modules loaded, check for permission
        problems.</li>
        <li>The options in <span class="fixed">shibboleth.xml</span> must be 
        configured as documented in <a href="#4.a.">4.a</a>. Apache content may 
        then need to be modified for Shibboleth authentication. This is 
        discussed in <a href="#4.d.">4.d</a>. It is recommended that the target 
        then be tested as detailed in section <a href="#5.a.">5.a</a>.</li>
    </ol>
</blockquote>
<h4><a name="3.d."></a>3.d. Configure Microsoft IIS</h4>
<blockquote>
    <ol type="1">
        <li>The package includes an ISAPI filter and bundled extension for 
        session startup in a single library, <span class="fixed">libexec\isapi_shib.dll</span>. 
        This filter is configured using commands in <span class="fixed">
        C:\opt\shibboleth\etc\shibboleth\shibboleth.xml</span> (or wherever you've
        installed the software). Make sure you or the installer has added the lib
        directory to the path as directed in <a href="#3.b.">section 3.b.</a>
        You will generally need to restart the system after installation.
        <p>Installing the extension into IIS is a two step process:
        <ol type="1">
            <li type="a">First, add the filter using the Internet Services 
            Manager MMC console. Right click on the machine icon on the left, 
            and edit the WWW Service master properties. On the &quot;ISAPI Filters&quot; 
            tab, add a new filter called Shibboleth and specify the DLL named 
            above. The priority should be High, and once the filter is loaded, 
            make sure it appears in the list <b>below</b> the &quot;sspifilt&quot; entry. 
            Restart IIS and make sure the filter shows up with a green arrow. 
            Check the Windows event log if it fails to load.</li>
            <li type="a">Secondly, map a special, distinct file extension, such as
            <span class="fixed">.shire</span>, to the ISAPI library so that 
            virtual URLs can be specified to invoke the extension handler for each 
            web site. Right click on the machine icon on the left, and edit the 
            WWW Service master properties. On the &quot;Home Directory&quot; tab, add a 
            script mapping using the &quot;Configuration&quot; button. The &quot;Executable&quot; 
            box should point to <span class="fixed">isapi_shib.dll</span>, and the 
            &quot;Extension&quot; can be set to anything unlikely to conflict, but
            <span class="fixed">.shire</span> is assumed (and the dot must be 
            included). You should NOT select the option to limit verbs, and 
            you MUST uncheck the &quot;Check that file exists&quot; box. On newer
            versions of IIS, checking the &quot;Script Engine&quot; box is suggested,
            as it will permit the extension to handle requests in directories with only
            script permissions assigned.</li>
            <li type="a"><font color="#444499">(IIS 6 Only)</font>  A new Web
            Service Extension must be defined for Shibboleth; without this, the
            mapping from <span class="fixed">*.shire</span> to <span
            class="fixed">isapi_shib.dll</span> won't occur and a file error
            will appear  Add this extension with an arbitrary name and associate
            it with <span class="fixed">isapi_shib.dll</span>.</li>
        </ol>
        </li>
        <li>All other aspects of configuration are handled via the
        <span class="fixed">shibboleth.xml</span> file and associated XML
        files described in subsequent sections. Particular use is made of 
        the <span class="fixed">/SHIRE/Implementation/ISAPI</span> element that allows
        IIS sites to be mapped to scheme, hostname, and port for proper request
        mapping and generation of redirects.</li>
        <li>Instance IDs are used in the IIS metabase to identify web sites. In older versions,
        they are applied starting with 1(one) and number the web sites in order in the
        Internet Services Manager from top to bottom. Newer versions appear to assign
        some IID values with strange ASCII formulas applied to the site name. A simple
        ASP or CGI script can be run within a site to dump the INSTANCE_ID header.</li>
        <li>See the following section for information on running the SHAR 
        service on Windows.</li>
        <li>The options in <span class="fixed">shibboleth.xml</span> must be 
        configured as documented in <a href="#4.a.">4.a</a>. It is recommended 
        that the target then be tested as detailed in section <a href="#5.a.">5.a</a>.</li>
    </ol>
</blockquote>
<h4><a name="3.e."></a>3.e. Running the SHAR on Windows</h4>
<blockquote>
    <p>The SHAR is a console application that is primarily designed to be 
    installed as a Windows service. To run the process in console mode for 
    testing or to diagnose major problems, the <span class="fixed">-console</span>
    parameter is used. Otherwise, parameters are used to install (or remove) the SHAR from the 
    service database and subsequent control is via the Service Control Manager 
    applet. The following command line parameters can be used:</p>
    <dl>
        <dd class="attribute"><span class="fixed">-console</span></dd>
        <dd class="value">Allows the process to be started from a command 
        prompt. Since the console will exit if the desktop user logs out, this 
        is not suitable for production use, but may be useful for testing.</dd>
        <dd class="attribute"><span class="fixed">-check</span></dd>
        <dd class="value">Validates the general correctness of the configuration.
        Not all problems can be detected this way, but the chance of successful startup
        is high if the checking process does not log any errors.</dd>
        <dd class="attribute"><span class="fixed">-config &lt;pathname&gt;</span> </dd>
        <dd class="value">Specifies the pathname of the SHAR&#39;s configuration 
        file. Defaults to <span class="fixed">\opt\shibboleth\etc\shibboleth\shibboleth.xml</span> 
        or the value of the <span class="fixed">SHIBCONFIG</span> environment 
        variable, if it is set.</dd>
        <dd class="attribute"><span class="fixed">-schemadir &lt;path&gt;</span> </dd>
        <dd class="value">Specifies the path to the XML schema files. Defaults to
        <span class="fixed">\opt\shibboleth\etc\shibboleth</span> or the value of the
        <span class="fixed">SHIBSCHEMAS</span> environment variable, if it is set.</dd>
        <dd class="attribute"><span class="fixed">-install &lt;servicename&gt;</span></dd>
        <dd class="value">Installs the SHAR as a named service in the Windows 
        service database. A name should be provided if multiple instances of the 
        SHAR need to be run on different ports, and thus installed separately. 
        The <span class="fixed">-config</span> option can be provided to include 
        a specific configuration file on the service&#39;s command line.</dd>
        <dd class="attribute"><span class="fixed">-remove &lt;servicename&gt;</span></dd>
        <dd class="value">Removes the named service instance of the SHAR from 
        the Windows service database.</dd>
    </dl>
    <h4><br>
    </h4>
</blockquote>
<hr>
<h3><a name="4."></a>4. Getting Running</h3>
<h4><a name="4.a."></a>4.a. Configuring <span class="fixed">shibboleth.xml</span></h4>
<blockquote>
	<p>The configuration for the target is mostly contained within <span class="fixed">shibboleth.xml</span>,
	located by default at <span class="fixed">\opt\shibboleth\etc\shibboleth\shibboleth.xml</span>.
	The target comes pre-configured with certificates and settings that will work against a test origin
	running on the same server; however, there are several values that must later be changed to interoperate
	with other sites securely and effectively.</p>
	<p>The following is a hyperlinked version of a basic configuration file, followed by a list of elements
	and attributes that must be modified. The actual example shipped with Shibboleth includes many more options
	that are commented out and other elements necessary to support test functionality.
	Click on any attribute or element for more information on its population and definition.</p>

<pre>
<a class="fixedlink" href="#confShibbolethTargetConfig">&lt;ShibbolethTargetConfig	xmlns=&quot;urn:mace:shibboleth:target:config:1.0&quot;
    logger=&quot;/opt/shibboleth/etc/shibboleth/shibboleth.logger&quot; clockSkew=&quot;180&quot;&gt;</a>

    <a class="fixedlink" href="#confExtensions">&lt;Extensions&gt;</a>
        <a class="fixedlink" href="#confLibrary">&lt;Library path=&quot;/opt/shibboleth/libexec/xmlproviders.so&quot; fatal=&quot;true&quot;/&gt;</a>
    <a class="fixedlink" href="#confExtensions">&lt;/Extensions&gt;</a>

    <a class="fixedlink" href="#confSHAR">&lt;SHAR logger=&quot;/opt/shibboleth/etc/shibboleth/shar.logger&quot;&gt;</a>

        <a class="fixedlink" href="#confExtensions">&lt;Extensions&gt;</a>
            <a class="fixedlink" href="#confLibrary">&lt;Library path=&quot;/opt/shibboleth/libexec/shib-mysql-ccache.so&quot; fatal=&quot;false&quot;/&gt;</a>
        <a class="fixedlink" href="#confExtensions">&lt;/Extensions&gt;</a>

        <a class="fixedlink" href="#confUnixListener">&lt;UnixListener address=&quot;/tmp/shar-socket&quot;/&gt;</a>

        &lt;!-- Primarily for Windows Deployments:
        <a class="fixedlink" href="#confTCPListener">&lt;TCPListener address=&quot;127.0.0.1&quot; port=&quot;12345&quot; acl=&quot;127.0.0.1&quot;/&gt;</a>
        --&gt;

        &lt;!--
        <a class="fixedlink" href="#confMemorySessionCache">&lt;MemorySessionCache cleanupInterval=&quot;300&quot; cacheTimeout=&quot;3600&quot; AATimeout=&quot;30&quot; AAConnectTimeout=&quot;15&quot;
            defaultLifetime=&quot;1800&quot; retryInterval=&quot;300&quot; strictValidity=&quot;true&quot; propagateErrors=&quot;true&quot;/&gt;</a>
        --&gt;
        
        <a class="fixedlink" href="#confMySQLSessionCache">&lt;MySQLSessionCache cleanupInterval=&quot;300&quot; cacheTimeout=&quot;3600&quot; AATimeout=&quot;30&quot; AAConnectTimeout=&quot;15&quot;
                defaultLifetime=&quot;1800&quot; retryInterval=&quot;300&quot; strictValidity=&quot;true&quot; propagateErrors=&quot;true&quot;
                mysqlTimeout=&quot;14400&quot;&gt;</a>
            <a class="fixedlink" href="#confArgument">&lt;Argument&gt;&#x2D;&#x2D;language=/opt/shibboleth/share/english&lt;/Argument&gt;</a>
            <a class="fixedlink" href="#confArgument">&lt;Argument&gt;datadir=/opt/shibboleth/data&lt;/Argument&gt;</a>
        &lt;/MySQLSessionCache&gt;

    <a class="fixedlink" href="#confSHAR">&lt;/SHAR&gt;</a>

    <a class="fixedlink" href="#confSHIRE">&lt;SHIRE logger=&quot;/opt/shibboleth/etc/shibboleth/shire.logger&quot;&gt;</a>

        <a class="fixedlink" href="#confRequestMapProvider">&lt;RequestMapProvider type=&quot;edu.internet2.middleware.shibboleth.target.provider.XMLRequestMap&quot;&gt;</a>
            <a class="fixedlink" href="#confRequestMap">&lt;RequestMap applicationId=&quot;default&quot;&gt;</a>
                <a class="fixedlink" href="#confHost">&lt;Host name=&quot;localhost&quot; scheme=&quot;https&quot;&gt;</a>
                    <a class="fixedlink" href="#confPath">&lt;Path name=&quot;secure&quot; requireSession=&quot;true&quot; exportAssertion=&quot;true&quot;&gt;
                            &lt;!-- Example shows a subfolder on the SSL port assigned to a separate &lt;Application&gt; --&gt;
                            &lt;Path name=&quot;admin&quot; applicationId=&quot;foo-admin&quot;/&gt;
                       &lt;/Path&gt;</a>
                <a class="fixedlink" href="#confHost">&lt;/Host&gt;</a>
                <a class="fixedlink" href="#confHost">&lt;Host name=&quot;localhost&quot; scheme=&quot;http&quot;&gt;</a>
                    <a class="fixedlink" href="#confPath">&lt;Path name=&quot;secure&quot; requireSession=&quot;true&quot; exportAssertion=&quot;true&quot;/&gt;</a>
                <a class="fixedlink" href="#confHost">&lt;/Host&gt;</a>
            <a class="fixedlink" href="#confRequestMap">&lt;/RequestMap&gt;</a>
        <a class="fixedlink" href="#confRequestMapProvider">&lt;/RequestMapProvider&gt;</a>

        &lt;!-- IIS only:
        <a class="fixedlink" href="#confImplementation">&lt;Implementation&gt;</a>
            <a class="fixedlink" href="#confISAPI">&lt;ISAPI normalizeRequest=&quot;true&quot;&gt;</a>
                <a class="fixedlink" href="#confSite">&lt;Site id=&quot;1&quot; scheme=&quot;https&quot; name=&quot;localhost&quot; port=&quot;443&quot;/&gt;</a>
            <a class="fixedlink" href="#confISAPI">&lt;/ISAPI&gt;</a>
        <a class="fixedlink" href="#confImplementation">&lt;/Implementation&gt;</a>
        --&gt;
    <a class="fixedlink" href="#confSHIRE">&lt;/SHIRE&gt;</a>

    <a class="fixedlink" href="#confApplications">&lt;Applications xmlns:saml=&quot;urn:oasis:names:tc:SAML:1.0:assertion&quot;
        applicationId=&quot;default&quot; providerId=&quot;https://example.org/shibboleth/target&quot;
        signRequest=&quot;false&quot; signedResponse=&quot;false&quot; signedAssertions=&quot;false&quot;&gt;</a>

        <a class="fixedlink" href="#confSessions">&lt;Sessions lifetime=&quot;7200&quot; timeout=&quot;3600&quot; checkAddress=&quot;true&quot;
            shireURL=&quot;/Shibboleth.shire&quot; shireSSL=&quot;false&quot; cookieName=&quot;_shibsession_default&quot; cookieProps=&quot;; path=/&quot;
            wayfURL=&quot;https://wayf.internet2.edu/InQueue/WAYF&quot;&gt;</a>

        <a class="fixedlink" href="#confErrors">&lt;Errors shire=&quot;/opt/shibboleth/etc/shibboleth/shireError.html&quot;
            rm=&quot;/opt/shibboleth/etc/shibboleth/rmError.html&quot;
            access=&quot;/opt/shibboleth/etc/shibboleth/accessError.html&quot;
            supportContact=&quot;root@localhost&quot;
            logoLocation=&quot;/shibtarget/logo.jpg&quot;
            styleSheet=&quot;/shibtarget/main.css&quot;/&gt;</a>

        <a class="fixedlink" href="#confCredentialUse">&lt;CredentialUse TLS=&quot;defcreds&quot; Signing=&quot;defcreds&quot;&gt;</a>
            <a class="fixedlink" href="#confRelyingParty">&lt;RelyingParty Name=&quot;urn:mace:inqueue&quot; TLS=&quot;inqueuecreds&quot; Signing=&quot;inqueuecreds&quot;/&gt;</a>
        <a class="fixedlink" href="#confCredentialUse">&lt;/CredentialUse&gt;</a>

        &lt;!--
        <a class="fixedlink" href="#confAttributeDesignator">&lt;AttributeDesignator AttributeName=&quot;urn:mace:dir:attribute-def:eduPersonScopedAffiliation&quot;
            AttributeNamespace=&quot;urn:mace:shibboleth:1.0:attributeNamespace:uri&quot;/&gt;</a>
        --&gt;

        <a class="fixedlink" href="#confAAPProvider">&lt;AAPProvider type=&quot;edu.internet2.middleware.shibboleth.target.provider.XMLAAP&quot;
            uri=&quot;/opt/shibboleth/etc/shibboleth/AAP.xml&quot;/&gt;</a>

        <a class="fixedlink" href="#confFederationProvider">&lt;FederationProvider type=&quot;edu.internet2.middleware.shibboleth.common.provider.XMLMetadata&quot;
            uri=&quot;/opt/shibboleth/etc/shibboleth/sites.xml&quot;/&gt;</a>

        <a class="fixedlink" href="#confTrustProvider">&lt;TrustProvider type=&quot;edu.internet2.middleware.shibboleth.common.provider.XMLTrust&quot;
            uri=&quot;/opt/shibboleth/etc/shibboleth/trust.xml&quot;/&gt;</a>

        &lt;!--
        <a class="fixedlink" href="#confRevocationProvider">&lt;RevocationProvider type=&quot;edu.internet2.middleware.shibboleth.common.provider.XMLRevocation&quot;
            uri=&quot;/opt/shibboleth/etc/shibboleth/trust.xml&quot;/&gt;</a>
        --&gt;

        <a class="fixedlink" href="confAudience">&lt;saml:Audience&gt;urn:mace:inqueue&lt;/saml:Audience&gt;</a>

        &lt;!-- Override settings for this application.
        <a class="fixedlink" href="confApplication">&lt;Application id=&quot;foo-admin&quot;&gt;</a>
            <a class="fixedlink" href="#confSessions">&lt;Sessions lifetime=&quot;7200&quot; timeout=&quot;3600&quot; checkAddress=&quot;true&quot;
                shireURL=&quot;/secure/admin/Shibboleth.shire&quot; shireSSL=&quot;true&quot; cookieProps=&quot;; path=/secure/admin; secure&quot;
                wayfURL=&quot;https://wayf.internet2.edu/InQueue/WAYF&quot;/&gt;</a>
            <a class="fixedlink" href="#confAttributeDesignator">&lt;saml:AttributeDesignator AttributeName=&quot;urn:mace:dir:attribute-def:eduPersonPrincipalName&quot;
                AttributeNamespace=&quot;urn:mace:shibboleth:1.0:attributeNamespace:uri&quot;/&gt;</a>
        <a class="fixedlink" href="confApplication">&lt;/Application&gt;</a>
        --&gt;

    <a class="fixedlink" href="#confApplications">&lt;/Applications&gt;</a>

    <a class="fixedlink" href="#confCredentialsProvider">&lt;CredentialsProvider type=&quot;edu.internet2.middleware.shibboleth.common.Credentials&quot;&gt;</a>
        <a class="fixedlink" href="#confCredentials">&lt;Credentials xmlns=&quot;urn:mace:shibboleth:credentials:1.0&quot;&gt;</a>
            <a class="fixedlink" href="#confFileResolver">&lt;FileResolver Id=&quot;defcreds&quot;&gt;</a>
                <a class="fixedlink" href="#confKey">&lt;Key format=&quot;PEM&quot; password=&quot;secret&quot;&gt;</a>
                    <a class="fixedlink" href="#confCredPath">&lt;Path&gt;/opt/shibboleth/etc/shibboleth/shar.key&lt;/Path&gt;</a>
                <a class="fixedlink" href="#confKey">&lt;/Key&gt;</a>
                <a class="fixedlink" href="#confCertificate">&lt;Certificate format=&quot;PEM&quot;&gt;</a>
                    <a class="fixedlink" href="#confCredPath">&lt;Path&gt;/opt/shibboleth/etc/shibboleth/shar.crt&lt;/Path&gt;</a>
                    <a class="fixedlink" href="#confCAPath">&lt;CAPath&gt;/opt/shibboleth/etc/shibboleth/ca.crt&lt;/CAPath&gt;</a>
                <a class="fixedlink" href="#confCertificate">&lt;/Certificate&gt;</a>
            <a class="fixedlink" href="#confFileResolver">&lt;/FileResolver&gt;</a>
        <a class="fixedlink" href="#confCredentials">&lt;/Credentials&gt;</a>
    <a class="fixedlink" href="#confCredentialsProvider">&lt;/CredentialsProvider&gt;</a>

<a class="fixedlink" href="#confShibbolethTargetConfig">&lt;/ShibbolethTargetConfig&gt;</a>
</pre>

<p>The following changes must be made to the default configuration before the target will interoperate in a federation.</p>
    <ol type="1">
        <li> 
        <p>The main <a href="#confApplications"><span class="fixed">Applications</span></a> element's
        <span class="fixed">providerId</span> attribute must be changed to reflect the URI this target will
        use to identify itself to origins by default. This will often be approved or supplied by a federation.</p>
		</li>
		<li>
		<p>The <span class="fixed">supportContact</span> and error templates for the target found in the
		<a href="#confErrors"><span class="fixed">Errors</span></a> element should be changed to ensure that
		users have a proper support mechanism.</p>
		</li>
		<li>
		<p>Proper credentials for this target signed by an authority that the federation recognizes must be
		 referenced by the <a href="#confCredentials"><span class="fixed">Credentials</span></a> element.
		 The default configuration points at files containing widely-available, insecure keys and certificates.
		 Note that keys are supported in a variety of formats: DER, PEM, encrypted PEM, PKCS8, and encrypted PKCS8.</p>
        </li>
        <li>
        <p><a href="#confFederationProvider"><span class="fixed">FederationProvider</span></a> and
        <a href="#confTrustProvider"><span class="fixed">TrustProvider</span></a> elements must be added or
        changed as needed to reflect the arrangements required. This information is often provided by
        federations to their members.</p>
        </li>
    </ol>

    <p>For Apache (but not IIS), there is also information that must be 
    configured in <span class="fixed">/usr/local/apache/conf/httpd.conf</span> 
    (or equivalent);&nbsp; for more information, refer to <a href="#3.c.2.">3.c</a>.</p>
    <p>Information in the logging configuration files referenced by
    <span class="fixed">shibboleth.xml</span> may require additional changes to 
    meet local needs. The logging level can be raised to <span class="fixed">
    DEBUG</span> if extremely detailed information is needed for testing.
    It is recommended that after initial installation is 
    completed, the log level in both files be left at either <span class="fixed">
    INFO</span> or <span class="fixed">WARN</span>.</p>
    <p>All elements are optional unless otherwise specified.  All attributes of an element are optional unless
    designated <span class="mandatory">mandatory</span> by a purple background.</p>
    <dl>
        <dd class="attribute"><a name="confAAPProvider"><span class="fixed">&lt;AAPProvider <span class="mandatory">type=&quot;edu.internet2.middleware.shibboleth.target.provider.XMLAAP&quot;</span> uri=&quot;<i>pathname</i>&quot;/&gt;</span></a></dd>
        <dd class="value">
        <p>This element is used to specify individual attribute acceptance policies that will apply to an application
        and may appear zero or more times within the <a href="#confApplications"><span class="fixed">Applications</span></a>
        or <a href="#confApplication"><span class="fixed">Application</span></a> element. For information about these
        policies and their format, refer to <a href="#4.e.">section 4.e</a>.</p>
        <p>The default set of AAP providers in the <a href="#confApplications"><span class="fixed">Applications</span></a>
        element can be replaced within individual <a href="#confApplication"><span class="fixed">Application</span></a> elements.</p>
        </dd>

        <dd class="attribute"><a name="confApplication"><span class="fixed">&lt;Application <span class="mandatory">id=&quot;<i>identifier</i>&quot;</span> providerId=&quot;<i>identifier</i>&quot; signRequest=&quot;<i>true/false</i>&quot; signedResponse=&quot;<i>true/false</i>&quot; signedAssertions=&quot;<i>true/false</i>&quot;&gt;</span></a></dd>
        <dd class="value">
        <p>Individual applications that require different attributes, session settings, metadata, etc. can be differentiated
        from the default configuration as specified in the <a href="#confApplications"><span class="fixed">Applications</span></a>
        element. It must contain a <a href="#confSessions"><span class="fixed">Sessions</span></a> element, but overriding other
        elements is optional.</p>
            <ul>
            <li class="mandatory"><span class="fixed">id</span>: This attribute defines an internal identifier allowing
                individual <span class="fixed">applicationId</span> attributes as part of
                <a href="#confHost"><span class="fixed">Host</span></a> and <a href="#confPath"><span class="fixed">Path</span></a>
                elements to point to this <span class="fixed">Application</span> to handle requests.</li>
            <li><span class="fixed">providerId</span>: Distinct from the internal identifier, this is the unique identifier
                that will be used when communicating with origin sites to request authentication or attributes.
                This value is referenced by origins when creating rules for the release of attributes to targets and will
                often be provided to federations to facilitate origin configuration. If none is specified, the default
                <a href="#confApplications"><span class="fixed">Applications</span></a> element's
                <span class="fixed">providerId</span> applies.</li>
            <li><span class="fixed">signRequest</span>: If <span class="fixed">true</span>, the target will sign attribute
            requests that it sends to origins on behalf of this application. This is usually unnecessary, as the
            TLS/SSL transport can provide authentication more efficiently.</li>
            <li><span class="fixed">signedResponse</span>: If <span class="fixed">true</span>, the target will require that
            all SAML attribute responses it receives for this application be signed.</li>
            <li><span class="fixed">signedAssertions</span>: If <span class="fixed">true</span>, the target will require that
            individual SAML assertions it receives for this application be signed. This may be particularly useful if the
            application is forwarding the assertion, but requires a liberal (or no) AAP to avoid corrupting the signature.</li>
            </ul>
        </dd>

        <dd class="attribute"><a name="confApplications"><span class="fixed">&lt;Applications <span class="mandatory">id=&quot;<i>default</i>&quot; providerId=&quot;<i>identifier</i>&quot;</span> signRequest=&quot;<i>true/false</i>&quot; signedResponse=&quot;<i>true/false</i>&quot; signedAssertions=&quot;<i>true/false</i>&quot;&gt;</span></a></dd>
        <dd class="value">
        <p>The <span class="fixed">Applications</span> element must appear once and contains default settings for requests
        handled by the target. It must contain at least one each of the <a href="#confSessions"><span class="fixed">Sessions</span></a>,
        and <a href="#confErrors"><span class="fixed">Errors</span></a> elements, and may contain
        <a href="#confCredentialUse"><span class="fixed">CredentialUse</span></a>,
        <a href="#confAttributeDesignator"><span class="fixed">saml:AttributeDesignator</span></a>,
        <a href="#confAudience"><span class="fixed">saml:Audience</span></a>,
        <a href="#confFederationProvider"><span class="fixed">FederationProvider</span></a>,
        <a href="#confTrustProvider"><span class="fixed">TrustProvider</span></a>,
        <a href="#confRevocationProvider"><span class="fixed">RevocationProvider</span></a>,
        and <a href="#confApplication"><span class="fixed">Application</span></a> elements.</p>
            <ul>
            <li class="mandatory"><span class="fixed">id</span>: This attribute has a fixed value of "default" and should not be changed.</li>
            <li class="mandatory"><span class="fixed">providerId</span>: Distinct from the internal identifier, the
                <span class="fixed">providerId</span> is the unique identifier that will be used when communicating
                with origin sites to request authentication or attributes. This value is referenced by origins when
                creating rules for the release of attributes to targets and will often be provided to federations to
                facilitate origin configuration.</li>
            <li><span class="fixed">signRequest</span>: If <span class="fixed">true</span>, the target will sign attribute
            requests that it sends to origins by default. This is usually unnecessary, as the TLS/SSL transport can provide
            authentication more efficiently.</li>
            <li><span class="fixed">signedResponse</span>: If <span class="fixed">true</span>, the target will require that
            all SAML attribute responses it receives are signed by default.</li>
            <li><span class="fixed">signedAssertions</span>: If <span class="fixed">true</span>, the target will require that
            individual SAML assertions it receives are signed by default. This may be particularly useful if the
            application is forwarding the assertion, but requires a liberal (or no) AAP to avoid corrupting the signature.</li>
            </ul>
        <p>Default settings can be overridden by using the <a href="#confRequestMap"><span class="fixed">RequestMap</span></a> to
        assign a non-default <span class="fixed">applicationId</span> to particular content in
        <a href="#confHost"><span class="fixed">Host</span></a> and <a href="#confPath"><span class="fixed">Path</span></a>
        elements. An <a href="#confApplication"><span class="fixed">Application</span></a> element is then inserted containing
        a matching <span class="fixed">id</span> attribute, and finally specific elements that override the defaults are
        placed within it. A fully specified <a href="#confSessions"><span class="fixed">Sessions</span></a> element is
        always required for any new application created, because each application needs a distinct
        <span class="fixed">shireURL</span> so that new sessions can be unambiguously mapped to a particular application.</p>
        </dd>

        <dd class="attribute"><a name="confArgument"><span class="fixed">&lt;Argument&gt;<i>value</i>&lt;/Argument&gt;</span></a></dd>
        <dd class="value">
        <p>The <span class="fixed">Argument</span> element is used in the
        <a href="#confMySQLSessionCache"><span class="fixed">MySQLSessionCache</span></a> element to specify one or more
        arguments to pass to the MySQL database engine.</p>
        </dd>

        <dd class="attribute"><a name="confAttributeDesignator"><span class="fixed">&lt;saml:AttributeDesignator <span class="mandatory">AttributeName=&quot;<i>name</i>&quot; AttributeNamespace=&quot;<i>namespace</i>&quot;</span>&gt;</span></a></dd>
        <dd class="value">
        <p>The <span class="fixed">AttributeDesignator</span> element is used in the
        <a href="#confApplications"><span class="fixed">Applications</span></a> and
        <a href="#confApplication"><span class="fixed">Application</span></a> elements to name an attribute to specifically
        request from origins on behalf of an application. If none are specified, the application will be given anything
        the origin allows it to receive.</p>
            <ul>
            <li class="mandatory"><span class="fixed">AttributeName</span>: Specifies the name of a SAML attribute, generally a URI.</li>
            <li class="mandatory"><span class="fixed">AttributeNamespace</span>: Specifies the attribute's SAML namespace,
            which Shibboleth by convention sets to &quot;urn:mace:shibboleth:1.0:attributeNamespace:uri&quot;.</li>
            </ul>
        <p>The default set of designators can be overridden within individual
        <a href="#confApplication"><span class="fixed">Application</span></a> elements, but if default elements are specified,
        it isn't possible to &quot;remove&quot; them and revert to none within a particular application.</p>
        </dd>

        <dd class="attribute"><a name="confAudience"><span class="fixed">&lt;saml:Audience&gt;<i>value</i>&lt;/saml:Audience&gt;</span></a></dd>
        <dd class="value">
        <p>The <span class="fixed">Audience</span> element is used in the
        <a href="#confApplications"><span class="fixed">Applications</span></a> and
        <a href="#confApplication"><span class="fixed">Application</span></a> elements element to specify one or more
        SAML audience URIs to designate while processing assertions. Audience values are used by origins to constrain the
        parties they issue assertions for. A target application always includes its own <span class="fixed">providerId</span>
        as an audience value.</p>
        <p>Within an <a href="#confApplication"><span class="fixed">Application</span></a> element, this setting is not
        inherited from the <a href="#confApplications"><span class="fixed">Applications</span></a> element. Any values
        desired must be specified. In most cases, this element can be omitted.</p>
        </dd>

        <dd class="attribute"><a name="confCAPath"><span class="fixed">&lt;CAPath&gt;<i>pathname</i>&lt;/CAPath&gt;</span></a></dd>
        <dd class="value">
        <p>Paired with a <a href="#confCredPath"><span class="fixed">Path</span></a> element within a
        <a href="#confFileResolver"><span class="fixed">FileResolver</span></a> element, it allows for the specification
        of additional certificates in a chain up to a trust anchor. As many <span class="fixed">CAPath</span> elements as
        necessary to complete the chain may be specified. May be needed if the relying party does not possess the entire CA
        chain already.</p>
        </dd>

        <dd class="attribute"><a name="confCertificate"><span class="fixed">&lt;Certificate format=&quot;<i>type</i>&quot;&gt;</span></a></dd>
        <dd class="value">
        <p>This specifies the certificate corresponding to this set of credentials. The certificate itself must be specified
        by a <a href="#confCredPath"><span class="fixed">Path</span></a> element contained by this element. If the certificate
        isn't self-signed or signed by an authority familiar to the relying party, the files of certificates in the path to
        the root authority may be specified using one or more <a href="#confCAPath"><span class="fixed">CAPath</span></a> elements.
        Valid formats are <span class="fixed">PEM</span>, <span class="fixed">DER</span>, and <span class="fixed">PKCS12</span>.</p>
        <p>It's placed within the <a href="#confFileResolver"><span class="fixed">FileResolver</span></a> element and must be
        paired with the corresponding private key using the <a href="#confKey"><span class="fixed">Key</span></a> element.</p>
        </dd>

        <dd class="attribute"><a name="confCredentials"><span class="fixed">&lt;Credentials xmlns=&quot;urn:mace:shibboleth:credentials:1.0&quot;&gt;</span></a></dd>
        <dd class="value">
        <p>This element is the container for credentials used by the XML-based credentials provider with type
        &quot;edu.internet2.middleware.shibboleth.common.Credentials&quot;. These credentials are used by the target to
        authenticate itself in SSL sessions or sign attribute requests, depending on application configuration. It must contain
        one or more <a href="#confFileResolver"><span class="fixed">FileResolver</span></a> elements.</p>
        </dd>

        <dd class="attribute"><a name="confCredentialsProvider"><span class="fixed">&lt;CredentialsProvider <span class="mandatory">type=&quot;edu.internet2.middleware.shibboleth.common.Credentials&quot;</span>&gt;</span></a></dd>
        <dd class="value">
        <p>This element is the container for providers of credentials used by the target and is placed inside the
        <a href="#confShibbolethTargetConfig"><span class="fixed">ShibbolethTargetConfig</span></a> element. The supplied
        provider of type &quot;edu.internet2.middleware.shibboleth.common.Credentials&quot; must contain one
        <a href="#confCredentials"><span class="fixed">Credentials</span></a> element detailing the credentials
        to be used by the target. Other provider types might require different content.</p>
        </dd>

        <dd class="attribute"><a name="confCredentialUse"><span class="fixed">&lt;CredentialUse <span class="mandatory">TLS=&quot;<i>string</i>&quot; Signing=&quot;<i>string</i>&quot;</span>&gt;</span></a></dd>
        <dd class="value">
        <p>Used in the <a href="#confApplications"><span class="fixed">Applications</span></a> or
        <a href="#confApplication"><span class="fixed">Application</span></a> elements to specify the credentials used by
        applications for signing and TLS/SSL. The <span class="fixed">TLS</span> and <span class="fixed">Signing</span>
        attribute values reference the identifiers of credential resolvers defined in the
        <a href="#confCredentialsProvider"><span class="fixed">CredentialsProvider</span></a> element. May also contain
        <a href="#confRelyingParty"><span class="fixed">RelyingParty</span></a> elements that specify the credentials
        to use for specific origins or federations.</p>
        </dd>

        <dd class="attribute"><a name="confErrors"><span class="fixed">&lt;Errors <span class="mandatory">shire=&quot;<i>pathname</i>&quot; rm=&quot;<i>pathname</i>&quot; access=&quot;<i>pathname</i>&quot;</span> supportContact=&quot;<i>e-mail</i>&quot; logoLocation=&quot;<i>URL</i>&quot;/&gt;</span></a></dd>
        <dd class="value">
        <p>Shibboleth is capable of displaying customized error pages based on templates and information provided by
        additional attributes in this element. These should all be customized to fit the requirements of the target application.
        For more information on configuration of error page generation, please see <a href="#4.b.">section 4.b</a>.</p>
            <ul>
            <li class="mandatory"><span class="fixed">shire</span>: Specifies the location of the template for the error page
            generated when there is an error re-directing the user to the WAYF or processing a new session sign-on.</li>
            <li class="mandatory"><span class="fixed">rm</span>: Specifies the location of the template for the error page
            generated if internal errors occur when supplying attributes to the application.</li>
            <li class="mandatory"><span class="fixed">accessError</span>: Specifies the location of the template for the page
            displayed to users when access to a protected resource is denied based on access control. This is distinct
            from when errors occur during the evaluation process itself, and indicates a denial of authorization.</li>
            <li><span class="fixed">supportContact</span>: Specifies a support e-mail address for the user to contact.</li>
            <li><span class="fixed">logoLocation</span>: Specifies the location of the logo used in the generation of error pages.
            This logo can be in any format that the web browser will understand, and should be a URL (absolute or relative) that
            will return a valid logo.</li>
            </ul>
        <p>The last two attributes are examples of tags that can be inserted at runtime into the templates. Arbitrary
        attributes may be specified in this element simply by adding them; no additional configuration is necessary.
        If there is a matching ShibMLP tag in the error page template as designed in <a href="#4.b.">4.b</a>, Shibboleth
        will insert the value of that attribute.</p>
        </dd>

        <dd class="attribute"><a name="confExtensions"><span class="fixed">&lt;Extensions&gt;</span></a></dd>
        <dd class="value">
        Extension libraries for one of the Shibboleth components or the entire target can be specified using this element
        depending on where it's present. It may be contained by any of the
        <a href="#confSHAR"><span class="fixed">SHAR</span></a>, <a href="#confSHIRE"><span class="fixed">SHIRE</span></a>,
        or <a href="#confShibbolethTargetConfig"><span class="fixed">ShibbolethTargetConfig</span></a> elements.
        It must contain one or more <a href="#confLibrary"><span class="fixed">Library</span></a> elements.
        </dd>

        <dd class="attribute"><a name="confFederationProvider"><span class="fixed">&lt;FederationProvider <span class="mandatory">type=&quot;edu.internet2.middleware.shibboleth.common.provider.XMLMetadata&quot;</span> uri=&quot;<i>pathname</i>&quot;&gt;</span></a></dd>
        <dd class="value">
        <p>This element, when specified within an <a href="#confApplications"><span class="fixed">Applications</span></a>
        or <a href="#confApplication"><span class="fixed">Application</span></a> element, points to operational metadata either
        inline within the element or in a local XML file. Federations will often publish signed XML files for targets to download
        periodically. This should be refreshed regularly; see <a href="#4.g.">section 4.g</a> for further details.</p>
        <p>The default set of federation providers in the <a href="#confApplications"><span class="fixed">Applications</span></a>
        element can be replaced within individual <a href="#confApplication"><span class="fixed">Application</span></a> elements.</p>
        </dd>

        <dd class="attribute"><a name="confFileResolver"><span class="fixed">&lt;FileResolver <span class="mandatory">Id=&quot;<i>string</i>&quot;</span>&gt;</span></a></dd>
        <dd class="value">
        <p>This element defines files used to store a private key, certificate, and certificate authorities and associates
        the set with an identifier. Placed inside the <a href="#confCredentials"><span class="fixed">Credentials</span></a>
        element. <a href="#confCredentialUse"><span class="fixed">CredentialUse</span></a> and
        <a href="#confRelyingParty"><span class="fixed">RelyingParty</span></a> elements will refer to these identifiers in
        their <span class="fixed">TLS</span> and <span class="fixed">Signing</span> attributes, allowing different credentials
        to be used for different applications and relying parties.</p>
        <p>Must contain one <a href="#confKey"><span class="fixed">Key</span></a> element and should contain one
        <a href="#confCertificate"><span class="fixed">Certificate</span></a> element.</p>
        </dd>

        <dd class="attribute"><a name="confHost"><span class="fixed">&lt;Host scheme=&quot;<i>protocol</i>&quot; <span class="mandatory">name=&quot;<i>fqdn</i>&quot;</span> port=&quot;<i>integer</i>&quot; applicationId=&quot;<i>id</i>&quot; requireSession=&quot;<i>true/false</i>&quot; exportAssertion=&quot;<i>true/false</i>&quot;&gt;</span></a></dd>
        <dd class="value">
        <p>Individual (real or virtual) hosts that this target protects are enumerated by <span class="fixed">Host</span> elements
        inside the <a href="#confRequestMap"><span class="fixed">RequestMap</span></a> element. If a request is processed by
        Shibboleth for a URL on this host, these parameters will be applied to it. If there are
        <a href="#confPath"><span class="fixed">Path</span></a> elements within this element that match the URL and contain
        the <span class="fixed">applicationId</span>, <span class="fixed">requireSession</span>, or
        <span class="fixed">exportAssertion</span> attributes, they will override values in this element; similarly, values
        within this element will override those in the containing
        <a href="#confRequestMap"><span class="fixed">RequestMap</span></a> element.</p>
            <ul>
            <li><span class="fixed">scheme</span>: This specifies the protocol on which this host responds.
            Valid choices are <span class="fixed">http</span>, <span class="fixed">https</span>, <span class="fixed">ftp</span>,
            <span class="fixed">ldap</span>, and <span class="fixed">ldaps</span>.</li>
            <li class="mandatory"><span class="fixed">name</span>: This is the fully-qualified domain name of the host.
            This appended to the <span class="fixed">scheme</span> must match what is contained in the URL for the element's
            settings to apply to the request.</li>
            <li><span class="fixed">port</span>: This is the port the host is listening on, if not the standard port for the scheme.</li>
            <li><span class="fixed">requireSession</span>: This attribute controls whether Shibboleth will forcibly establish
            an authenticated session with the user before handing off the request to the web server or application.
            If <span class="fixed">true</span>, Shibboleth will force session establishment. If <span class="fixed">false</span>
            (the default), applications are responsible for ensuring that a session exists if necessary, so-called
            <a href="#1.g.">lazy session establishment</a>. Most deployments should not specify <span class="fixed">false</span>
            for protected content without a full understanding of the implications.</li>
            <li><span class="fixed">exportAssertion</span>: When <span class="fixed">true</span>, the entire SAML attribute
            assertion received from the origin is exported to a CGI request header called
            <span class="fixed">Shib-Attributes</span>, encoded in <span class="fixed">base64</span>. This requires an
            application to be able to parse the raw XML. Defaults to <span class="fixed">false</span>, which most deployments
            should use.</li>
            </ul>
        </dd>

        <dd class="attribute"><a name="confImplementation"><span class="fixed">&lt;Implementation&gt;</span></a></dd>
        <dd class="value">
        <p>A container element placed inside the <a href="#confSHIRE"><span class="fixed">SHIRE</span></a> element,
        the contents of this element will vary depending on the web server or environment that this Shibboleth deployment serves.
        Multiple configurations may be specified, but only one per implementation type. This element may contain the
        <a href="#confISAPI"><span class="fixed">ISAPI</span></a> element.</p>
        </dd>

        <dd class="attribute"><a name="confISAPI"><span class="fixed">&lt;ISAPI normalizeRequest=&quot;<i>true/false</i>&quot;&gt;</span></a></dd>
        <dd class="value">
        <p>The configuration information for Shibboleth targets deployed on Microsoft IIS is stored inside this container element.
        This element must contain one or more <a href="#confSite"><span class="fixed">Site</span></a> elements, each of which
        maps an INSTANCE ID value to a hostname. If <span class="fixed">normalizeRequest</span> is
        <span class="fixed">true</span> (the default), all redirects and computed request URLs generated by Shibboleth will
        be created using the hostname assigned to the site instance handling the request. If <span class="fixed">false</span>,
        the browser's supplied URL is sometimes used to compute the information. Placed inside the
        <a href="#confImplementation"><span class="fixed">Implementation</span></a> element.</p>
        </dd>

        <dd class="attribute"><a name="confKey"><span class="fixed">&lt;Key format=&quot;<i>type</i>&quot;&gt;</span></a></dd>
        <dd class="value">
        <p>Specifies a file containing a private key to be used within a set of credentials. Valid formats are
        <span class="fixed">PEM</span> (the default), <span class="fixed">DER</span>, and <span class="fixed">PKCS12</span>.
        Placed within a <a href="#confFileResolver"><span class="fixed">FileResolver</span></a> element, it should be paired
        with a <a href="#confCertificate"><span class="fixed">Certificate</span></a> element, and contain a
        <a href="#confCredPath"><span class="fixed">Path</span></a> element.</p>
        </dd>

        <dd class="attribute"><a name="confLibrary"><span class="fixed">&lt;Library <span class="mandatory">path=&quot;<i>pathname</i>&quot;</span> fatal=&quot;<i>true/false</i>&quot;/&gt;</span></a></dd>
        <dd class="value">
        <p>This element defines an extension library for one of Shibboleth's components and is placed within an
        <a href="#confExtensions"><span class="fixed">Extensions</span></a> element.</p>
            <ul>
            <li class="mandatory"><span class="fixed">path</span>: This designates the complete pathname of the library.</li>
            <li><span class="fixed">fatal</span>: If <span class="fixed">true</span> and the library is not located or fails
            to load properly, the target will not successfully initialize. The default is false.</li>
            </ul>
        </dd>

        <dd class="attribute"><a name="confListener"><span class="fixed">&lt;Listener <span class="mandatory">type=&quot;<i>string</i>&quot;</span>&gt;</span></a></dd>
        <dd class="value">
        <p>Specifies a pluggable implementation of a mechanism for communication between the web server and SHAR,
        specified in the <span class="fixed">type</span> attribute. This element is placed within the
        <a href="#confSHAR"><span class="fixed">SHAR</span></a> element and is mutually exclusive with the
        <a href="#confTCPListener"><span class="fixed">TCPListener</span></a> and
        <a href="#confUnixListener"><span class="fixed">UnixListener</span></a> elements.</p>
        </dd>

        <dd class="attribute"><a name="confMemorySessionCache"><span class="fixed">&lt;MemorySessionCache AAConnectTimeout=&quot;<i>seconds</i>&quot; AATimeout=&quot;<i>seconds</i>&quot; cacheTimeout=&quot;<i>seconds</i>&quot; cleanupInterval=&quot;<i>seconds</i>&quot; defaultLifetime=&quot;<i>seconds</i>&quot; propagateErrors=&quot;<i>true/false</i>&quot; retryInterval=&quot;<i>seconds</i>&quot; strictValidity=&quot;<i>true/false</i>&quot;/&gt;</span></a></dd>
        <dd class="value">
        <p>Shibboleth will cache sessions and received attributes in memory if this element is found in the
        <a href="#confSHAR"><span class="fixed">SHAR</span></a> element. This element is mutually exclusive with the
        <a href="#confMySQLSessionCache"><span class="fixed">MySQLSessionCache</span></a> and
        <a href="#confSessionCache"><span class="fixed">SessionCache</span></a> elements.</p>
            <ul>
            <li><span class="fixed">AAConnectTimeout</span>: Time in seconds the target will wait before timing out on the
            initial connection to an origin to request attributes.  Defaults to <span class="fixed">15</span>.</li>
            <li><span class="fixed">AATimeout</span>: Time in seconds the target will wait before timing out while waiting
            for attributes from an origin once the initial connection is established. Defaults to <span class="fixed">30</span>.</li>
            <li><span class="fixed">cacheTimeout</span>: Time in seconds to permit a session to stay in the cache before
            being purged. Defaults to <span class="fixed">28800</span>.</li>
            <li><span class="fixed">cleanupInterval</span>: Seconds between runs of the background thread that purges
            expired sessions. Defaults to <span class="fixed">300</span>.</li>
            <li><span class="fixed">defaultLifetime</span>: If the attribute assertion doesn't carry an explicit
            expiration time, the assertion will expire after this time in <span class="fixed">seconds</span> has elapsed.
            Defaults to <span class="fixed">1800</span>.</li>
            <li><span class="fixed">propagateErrors</span>: If true, then any errors that occur during the attribute
            query stage are fatal and will be presented to the user as an error, terminating their session. If false,
            any errors that occur during the query are non-fatal, and the application will be given older, expired
            attributes based on the <span class="fixed">strictValidity</span> setting.
            <p>This should generally only be left to false (the default) by deployments that are using real principal
            names as subjects because attribute retrieval is treated as an optional process.</p></li>
            <li><span class="fixed">retryInterval</span>: Time in seconds between attempts to obtain fresh attributes.  If a query fails, a timer is set, and once the interval elapses, the next user request causes another query. This prevents pointless repeated attempts to query a failed origin. Defaults to <span class="fixed">300</span>.</li>
            <li><span class="fixed">strictValidity</span>: If true, expired attributes will never be made available to the Shibboleth application; if no valid attributes can be obtained, then an empty set is provided.  When false, if a fresh set of attributes cannot be retrieved due to failures, any cached, expired attributes are made available.  Defaults to <span class="fixed">true</span>.</li>
            </ul>
        </dd>

        <dd class="attribute"><a name="confMySQLSessionCache"><span class="fixed">&lt;MySQLSessionCache mysqlTimeout=&quot;<i>seconds</i>&quot;/&gt;</span></a></dd>
        <dd class="value">
        <p>Shibboleth will back the memory cache of sessions using an embedded MySQL database if this element is found
        in the <a href="#confSHAR"><span class="fixed">SHAR</span></a> element. Arguments may be passed directly to
        MySQL by populating this element with <span class="fixed"><a href="#confArgument">Argument</a></span> elements.
        The element may also specify any of the attributes defined for the <a href="#confMemorySessionCache">MemorySessionCache</a>
        element. Mutually exclusive with the <a href="#confMemorySessionCache"><span class="fixed">MemorySessionCache</span></a>
        and <a href="#confSessionCache"><span class="fixed">SessionCache</span></a> elements.</p>
            <ul>
            <li><span class="fixed">mysqlTimeout</span>: Time in seconds to permit a session to stay in the persistent
            cache before being purged. Defaults to <span class="fixed">28800</span>.</li>
            </ul>
        </dd>

        <dd class="attribute">(RequestMap) <a name="confPath"><span class="fixed">&lt;Path <span class="mandatory">name=&quot;<i>pathname</i>&quot;</span> applicationId=&quot;<i>id</i>&quot; requireSession=&quot;<i>true/false</i>&quot; exportAssertion=&quot;<i>true/false</i>&quot;&gt;</span></a></dd>
        <dd class="value">
        <p>This element allows for different application identifiers and session handling to be defined iteratively for
        subdirectories or documents within a host. Requests are processed on a best-match basis, with the innermost
        element taking precedence. Path elements may be contained by <a href="#confHost"><span class="fixed">Host</span></a>
        elements or other <a href="#confPath"><span class="fixed">Path</span></a> elements.</p>
            <ul>
            <li class="mandatory"><span class="fixed">name</span>: This is the name of the path component or filename to match
            against the request. Only exact matching is supported by the supplied request mapping provider.</li>
            <li><span class="fixed">requireSession</span>: This attribute controls whether Shibboleth will forcibly establish
            an authenticated session with the user before handing off the request to the web server or application.
            If <span class="fixed">true</span>, Shibboleth will force session establishment. If <span class="fixed">false</span>
            (the default), applications are responsible for ensuring that a session exists if necessary, so-called
            <a href="#1.g.">lazy session establishment</a>. Most deployments should not specify <span class="fixed">false</span>
            for protected content without a full understanding of the implications.</li>
            <li><span class="fixed">exportAssertion</span>: When <span class="fixed">true</span>, the entire SAML attribute
            assertion received from the origin is exported to a CGI request header called
            <span class="fixed">Shib-Attributes</span>, encoded in <span class="fixed">base64</span>. This requires an
            application to be able to parse the raw XML. Defaults to <span class="fixed">false</span>, which most deployments
            should use.</li>
            </ul>
        </dd>

        <dd class="attribute">(Credential) <a name="confCredPath"><span class="fixed">&lt;Path&gt;<i>pathname</i>&lt;/Path&gt;</span></a></dd>
        <dd class="value">
        <p>Placed inside the <a href="#confKey"><span class="fixed">Key</span></a> and
        <a href="#confCertificate"><span class="fixed">Certificate</span></a> elements to specify the pathname of the file
        containing the credential.</p>
        </dd>

        <dd class="attribute"><a name="confRelyingParty"><span class="fixed">&lt;RelyingParty <span class="mandatory">name=&quot;<i>string</i>&quot; TLS=&quot;<i>string</i>&quot; Signing=&quot;<i>string</i>&quot;</span>&gt;</span></a></dd>
        <dd class="value"><p>One or more <span class="fixed">RelyingParty</span> elements may be contained by a <a href="#confCredentialUse"><span class="fixed">CredentialUse</span></a> element to enumerate relying parties for which a distinct set of credentials should be used. The <span class="fixed">TLS</span> and <span class="fixed">Signing</span> attribute values reference the identifiers of credential resolvers defined in <a href="#confCredentialsProvider"><span class="fixed">CredentialsProvider</span></a> elements.</p>
<ul>
<li class="mandatory"><span class="fixed">name</span>: Identifies the origin site or group of sites to which the credentials specified in the element apply.  This is used to match the providerId sent within attribute assertions from origin sites against a set of "groups" based on metadata.</li>
</ul>
</dd>

        <dd class="attribute"><a name="confRequestMap"><span class="fixed">&lt;RequestMap <span class="mandatory">applicationId=&quot;<i>default</i>&quot;</span> requireSession=&quot;<i>true/false</i>&quot; exportAssertion=&quot;<i>true/false</i>&quot;&gt;</span></a></dd>
        <dd class="value">
        <p>The <span class="fixed">RequestMap</span> element is a container holding
        <a href="#confHost"><span class="fixed">Host</span></a> and <a href="#confPath"><span class="fixed">Path</span></a>
        elements. Request URLs processed by Shibboleth are parsed and matched against this set of elements in order to
        determine how to process the request. Attributes on the RequestMap, Host, and Path elements specify whether to
        require an authenticated session, and how to locate the associated Application element and settings.</p>
            <ul>
            <li><span class="fixed">applicationId</span>: Contains a fixed value of "default" to reference the default
            <a href="#confApplications"><span class="fixed">Applications</span></a> element.</li>
            <li><span class="fixed">requireSession</span>: This attribute controls whether Shibboleth will forcibly establish
            an authenticated session with the user before handing off the request to the web server or application.
            If <span class="fixed">true</span>, Shibboleth will force session establishment. If <span class="fixed">false</span>
            (the default), web applications are responsible for ensuring that a session exists if necessary, so-called
            <a href="#1.g.">lazy session establishment</a>. Most deployments should not specify <span class="fixed">false</span>
            for protected content without a full understanding of the implications.</li>
            <li><span class="fixed">exportAssertion</span>: When <span class="fixed">true</span>, the entire SAML attribute
            assertion received from the origin is exported to a CGI request header called
            <span class="fixed">Shib-Attributes</span>, encoded in <span class="fixed">base64</span>. This requires an
            application to be able to parse the raw XML. Defaults to <span class="fixed">false</span>, which most deployments
            should use.</li>
            </ul>
        </dd>

        <dd class="attribute"><a name="confRequestMapProvider"><span class="fixed">&lt;RequestMapProvider <span class="mandatory">type=&quot;edu.internet2.middleware.shibboleth.target.provider.XMLRequestMap&quot;</span> uri=&quot;<i>pathname</i>&quot;&gt;</span></a></dd>
        <dd class="value">
        <p>This element specifies a request mapper that defines how Shibboleth will handle sessions and other behavior
        for a given request. For the built-in type &quot;edu.internet2.middleware.shibboleth.target.provider.XMLRequestMap&quot;,
        there must be a <a href="#confRequestMap"><span class="fixed">RequestMap</span></a> element within this element, or
        the <span class="fixed">uri</span> attribute must contain the local pathname of an XML file containing one.</p>
        </dd>

        <dd class="attribute"><a name="confRevocationProvider"><span class="fixed">&lt;RevocationProvider <span class="mandatory">type=&quot;edu.internet2.middleware.shibboleth.common.provider.XMLRevocation&quot;</span> uri=&quot;<i>pathname</i>&quot;&gt;</span></a></dd>
        <dd class="value">
        <p>This element, when specified within an <a href="#confApplications"><span class="fixed">Applications</span></a>
        or <a href="#confApplication"><span class="fixed">Application</span></a> element, points to revocation information either
        inline within the element or in a local XML file. Federations will often publish signed XML files for targets to download
        periodically. This should be refreshed regularly; see <a href="#4.g.">section 4.g</a> for further details.</p>
        <p>The default set of revocation providers in the <a href="#confApplications"><span class="fixed">Applications</span></a>
        element can be replaced within individual <a href="#confApplication"><span class="fixed">Application</span></a> elements.</p>
        </dd>
        
        <dd class="attribute"><a name="confSessionCache"><span class="fixed">&lt;SessionCache <span class="mandatory">type=&quot;<i>string</i>&quot;</span>&gt;</span></a></dd>
        <dd class="value">
        <p>Specifies a pluggable session cache implementation of the specified <span class="fixed">type</span>. This element
        is placed within the <a href="#confSHAR"><span class="fixed">SHAR</span></a> element and is mutually exclusive with
        the <a href="#confMemorySessionCache"><span class="fixed">MemorySessionCache</span></a> and
        <a href="#confMySQLSessionCache"><span class="fixed">MySQLSessionCache</span></a> elements.</p>
        <p>Any plugin should support the basic attributes defined by the
        <a href="#confMemorySessionCache"><span class="fixed">MemorySessionCache</span></a> element.</p>
        </dd>

        <dd class="attribute"><a name="confSessions"><span class="fixed">&lt;Sessions
<span class="mandatory">wayfURL=&quot;<i>URL</i>&quot;
shireURL=&quot;<i>URL</i>&quot;</span>
shireSSL=&quot;<i>true/false</i>&quot;
lifetime=&quot;<i>seconds</i>&quot;
timeout=&quot;<i>seconds</i>&quot;
checkAddress=&quot;<i>true/false</i>&quot;
cookieName=&quot;<i>URL</i>&quot;
cookieProps=&quot;<i>URL</i>&quot;&gt;</span></a></dd>
        <dd class="value">
        <p>Configuration parameters that affect the way Shibboleth handles sessions for an individual application are bundled
        in this element, which must be included in each <a href="#confApplication"><span class="fixed">Application</span></a>
        and the default <a href="#confApplications"><span class="fixed">Applications</span></a> element. Note that these
        parameters only apply to Shibboleth sessions, and not any sessions applications manage on their own behalf.</p>
            <ul>
            <li class="mandatory"><span class="fixed">wayfURL</span>: The URL of the <a href="#1.c.">WAYF service</a>
            responsible for redirecting users accessing this application to their identity provider (origin).</li>
            <li class="mandatory">
                <p><span class="fixed">shireURL</span>: Specifies the SHIRE URL, or assertion consumer service, at which
                new sessions are initiated or lazy sessions are triggered. This can be an absolute URL, or a relative path
                to be prefixed by the base URL of the virtual host. Using an absolute URL allows a virtual server to funnel
                requests to a fixed location, to force use of SSL, for example.</p>
                <p>Note that this URL issues the session cookie set on behalf of the application, and this cookie must be
                returned in subsequent requests, so the virtual host's domain name and port must be consistent with this
                domain name and port for some browsers to properly return the cookie. If default ports are used (and thus
                left unspecified), browsers will generally return cookies set via SSL to a non-SSL port. If non-default
                ports are used, it is recommended that this be a relative URL so that each virtual host handles its own
                cookie operations.</p>
                <p>For Shibboleth to function properly in IIS, the file extension at the end of this URL must match the
                value configured into IIS and mapped to the ISAPI extension. This causes the request to be serviced properly,
                even though no file by that name actually exists.</p>
            </li>
            <li><span class="fixed">shireSSL</span>: If <span class="fixed">true</span> (the default), the application will
            <b>only</b> accept new session requests over SSL, as is strongly recommended; see <a href="#2.c.">section 2.c</a>
            for more details.</li>
            <li><span class="fixed">cookieName</span>: Optionally specifies the name given to in-memory session cookies that
            are associated with this application. If omitted, Shibboleth will generate a cookie name for you of the form
            _shibsession_&lt;Application ID&gt;</li>
            <li><span class="fixed">cookieProps</span>: A string of additional Set-Cookie properties can be specified using
            this element which give the browser further instructions about cookie processing and use. Always begin with a
            semicolon to delineate from the session ID value.</li>
            <li><span class="fixed">lifetime</span>: Duration in seconds of the Shibboleth session; this does not affect
            the lifetime of application sessions initiated independently of Shibboleth. Defaults to 3600. If 0 is specified,
            sessions are infinite, subject to purging by the cache.</li>
            <li><span class="fixed">timeout</span>: If the value in seconds elapses following the last request in a
            session, the session will be expired for inactivity and a new session must be initiated upon the next request.
            Defaults to 1800. If 0 is specified, there is no inactivity timeout</li>
            <li><span class="fixed">checkAddress</span>: If <span class="fixed">true</span> (the default), Shibboleth will
            check the browser's client address to insure that session cookies are issued and used by a consistent client address.
            In most circumstances, this should be enabled to help prevent attacks using stolen cookies, but this can cause
            problems for users behind proxies or NAT devices.</li>
            </ul>
        </dd>

        <dd class="attribute"><a name="confSHAR"><span class="fixed">&lt;SHAR logger=&quot;<i>pathname</i>&quot;&gt;</span></a></dd>
        <dd class="value">
        <p>This is the container element for configuration information pertaining to the SHAR, the target component responsible
        for most attribute and session processing. Its single attribute, <span class="fixed">logger</span>, points to a
        Log4J-format property configuration file that controls SHAR logging behavior. It is placed within the
        <a href="#confShibbolethTargetConfig"><span class="fixed">ShibbolethTargetConfig</span></a> element and may contain an
        <a href="#confExtensions"><span class="fixed">Extensions</span></a> element specifying additional libraries.</p>
        <p>It must contain either a <a href="#confUnixListener"><span class="fixed">UnixListener</span></a> element to listen
        to the server module on a UNIX domain socket or a <a href="#confTCPListener"><span class="fixed">TCPListener</span></a>
        element to listen on a TCP port. Session caching must also be specified using a
        <a href="#confMemorySessionCache"><span class="fixed">MemorySessionCache</span></a> element to use in-memory session
        caching or a <a href="#confMySQLSessionCache"><span class="fixed">MySQLSessionCache</span></a> element to backup session
        information into a MySQL database.</p>
        </dd>

        <dd class="attribute"><a name="confShibbolethTargetConfig"><span class="fixed">&lt;ShibbolethTargetConfig clockSkew=&quot;integer&quot;&gt;</span></a></dd>
        <dd class="value">
        <p>This is the root element for target configuration and must be present once and only once. It must always contain a
        <a href="#confSHAR"><span class="fixed">SHAR</span></a> element, a
        <a href="#confSHIRE"><span class="fixed">SHIRE</span></a> element, an
        <a href="#confApplications"><span class="fixed">Applications</span></a> element, one or more
        <a href="#confCredentialsProvider"><span class="fixed">CredentialsProvider</span></a> elements, and optionally an
        <a href="#confExtensions"><span class="fixed">Extensions</span></a> element.</p>
            <ul>
            <li><span class="fixed">clockSkew</span>: Controls allowed clock skew in seconds between target and origin servers
            when evaluating times sent in messages. Defaults to 180, and should be as small as practical.</li>
            </ul>
        </dd>

        <dd class="attribute"><a name="confSHIRE"><span class="fixed">&lt;SHIRE logger=&quot;<i>pathname</i>&quot;&gt;</span></a></dd>
        <dd class="value">
        <p>This is the container element for configuration information pertaining to the SHIRE, the part of the target that
        integrates into the web server environment. Its single attribute, <span class="fixed">logger</span>, points to a
        Log4J-format property configuration file that controls SHIRE logging behavior. It is placed within the
        <a href="#confShibbolethTargetConfig"><span class="fixed">ShibbolethTargetConfig</span></a> element and may contain an
        <a href="#confExtensions"><span class="fixed">Extensions</span></a> element specifying additional libraries.</p>
        <p>It may contain an <a href="#confImplementation"><span class="fixed">Implementation</span></a> element, within which
        configuration for the SHIRE which varies by platform will be specified.</p>
        <p>It may contain a <a href="#confRequestMapProvider"><span class="fixed">RequestMapProvider</span></a> element,
        which provides fine-grained control over aspects of target behavior at a host, path, or document level.</p>
        </dd>

        <dd class="attribute"><a name="confSite"><span class="fixed">&lt;Site <span class="mandatory">id=&quot;<i>INSTANCE_ID</i>&quot; name=&quot;<i>fqdn</i>&quot;</span> scheme=&quot;<i>http/https</i>&quot; port=&quot;<i>integer</i>&quot;&gt;</span></a></dd>
        <dd class="value">
        <p>This element is placed in the <a href="#confISAPI"><span class="fixed">ISAPI</span></a> element to specify a
        mapping from individual instance ID's to the corresponding hostname, port, and scheme.</p>
        </dd>

        <dd class="attribute"><a name="confTCPListener"><span class="fixed">&lt;TCPListener <span class="mandatory">address=&quot;<i>pathname</i>&quot;  port=&quot;<i>integer</i>&quot;</span> acl=&quot;<i>ip</i>&quot;&gt;</span></a></dd>
        <dd class="value">
        <p>This element is placed within the <a href="#confSHAR"><span class="fixed">SHAR</span></a> element and is mutually
        exclusive with the <a href="#confUnixListener"><span class="fixed">UnixListener</span></a> and
        <a href="#confListener"><span class="fixed">Listener</span></a> elements. It allows the SHAR to communicate with the
        web server component using TCP.</p>
            <ul>
            <li class="mandatory"><span class="fixed">address</span>: Specifies the IP address of the listener.</li>
            <li class="mandatory"><span class="fixed">port</span>: Specifies the TCP port on which the SHAR will listen.</li>
            <li><span class="fixed">acl</span>: By default, the SHAR will only listen to requests from 127.0.0.1 (localhost). 
            This should generally not be specified except in test environments.</li>
            </ul>
        </dd>

        <dd class="attribute"><a name="confTrustProvider"><span class="fixed">&lt;TrustProvider <span class="mandatory">type=&quot;edu.internet2.middleware.shibboleth.common.provider.XMLTrust&quot;</span> uri=&quot;<i>pathname</i>&quot;&gt;</span></a></dd>
        <dd class="value">
        <p>This element, when specified within an <a href="#confApplications"><span class="fixed">Applications</span></a>
        or <a href="#confApplication"><span class="fixed">Application</span></a> element, points to trust metadata either
        inline within the element or in a local XML file. Federations will often publish signed XML files for targets to download
        periodically. This should be refreshed regularly; see <a href="#4.g.">section 4.g</a> for further details.</p>
        <p>The default set of trust providers in the <a href="#confApplications"><span class="fixed">Applications</span></a>
        element can be replaced within individual <a href="#confApplication"><span class="fixed">Application</span></a> elements.</p>
        </dd>

        <dd class="attribute"><a name="confUnixListener"><span class="fixed">&lt;UnixListener address=&quot;<i>pathname</i>&quot;&gt;</span></a></dd>
        <dd class="value">
        <p>Use this element to specify a UNIX domain socket located at the <span class="fixed">pathname</span> specified in
        the <span class="fixed">address</span> attribute at which the SHAR should listen for requests. This element must be
        contained by the <a href="#confSHAR"><span class="fixed">SHAR</span></a> element and is mutually exclusive with the
        <a href="#confTCPListener"><span class="fixed">TCPListener</span></a> and
        <a href="#confListener"><span class="fixed">Listener</span></a> elements.
        <span class="fixed">UnixListener</span> cannot be specified for Windows-based installations.</p>
        </dd>

</dl></blockquote>
<h4><a name="4.b."></a>4.b. Dynamic Error Page Generation</h4>
<blockquote>
    <p>Shibboleth supports the dynamic generation of information in error pages 
    referenced by the <a href="#confErrors"><span class="fixed">Errors</span></a> element
    in <span class="fixed">shibboleth.xml</span>. The target implementation
    employs a simply template language to insert special tags into the 
    generated HTML. The parser will read the error template looking for any tag that 
    looks like:</p>
    <blockquote>
        <p><span class="fixed">&lt;shibmlp tag-name /&gt;</span> </p>
    </blockquote>
    <p>Shibboleth will replace <span class="fixed">tag-name</span> with the 
    appropriate markup tag either from the table below or by looking for a matching XML attribute
    in the <a href="#confErrors"><span class="fixed">Errors</span></a> element:</p>
    <dl>
        <dd class="attribute"><span class="fixed">requestURL</span></dd>
        <dd class="value">The user&#39;s requested URL.</dd>
        <dd class="attribute"><span class="fixed">errorType</span></dd>
        <dd class="value">The type of error.</dd>
        <dd class="attribute"><span class="fixed">errorText</span></dd>
        <dd class="value">The actual error message.</dd>
        <dd class="attribute"><span class="fixed">errorDesc</span></dd>
        <dd class="value">A textual description of the error intended for human 
        consumption.</dd>
        <dd class="attribute"><span class="fixed">originContactName</span></dd>
        <dd class="value">The contact name for the origin site provided by that 
        site&#39;s metadata.</dd>
        <dd class="attribute"><span class="fixed">originContactEmail</span></dd>
        <dd class="value">The contact email address for the origin site provided 
        by that site&#39;s metadata.</dd>
        <dd class="attribute"><span class="fixed">originErrorURL</span></dd>
        <dd class="value">The URL of an error handling page for the origin site 
        provided by that site&#39;s metadata.</dd>
    </dl>
    <p>To improve the appearance of error messages, a simple, limited form of
    conditional checking is supported so that the presence of absence of data
    to substitute into a particular tag-name can trigger the inclusion or
    exclusion of markup. Conditionals look like:</p>
    <blockquote>
        <p><span class="fixed">&lt;shibmlpif tag-name&gt; arbitrary markup &lt;/shibmlpif&gt;</span><br>
        <span class="fixed">&lt;shibmlpifnot tag-name&gt; arbitrary markup &lt;/shibmlpifnot&gt;</span></p>
    </blockquote>
    <p>Respectively, these special tags include or skip the markup between the tags if the
    specified tag-name has an associated value available to be substituted for it. Note that
    you cannot nest these conditionals; a <span class="fixed">shibmlpif</span> tag cannot
    appear inside another <span class="fixed">shibmlpif</span> tag, due to the simplicity
    of the substitution engine.</p>
    <p>Sample error templates for different kinds of errors are included in the 
    Shibboleth distribution, and can be triggered by anything that will cause 
    Shibboleth to be unable to accept an incoming session, obtain attributes,
    make an authorization decision, etc., including bad configuration settings,
    signature verification or certificate validation failures, or a skewed clock
    between sites.</p>
    <p><b>You should edit these templates, provide or remove style sheets and 
    images, and otherwise customize these templates to suit the user experience 
    you want your users to have when errors occur. The defaults are not likely 
    to meet the needs of any site.</b></p>
</blockquote>
<h4><a name="4.c."></a>4.c. Key Generation and Certificate Installation</h4>
<blockquote>
    <p>The only target component that must have a private key and certificate is 
    the SHAR. While the target server itself should support SSL in most cases 
    for users, it is mandatory for the SHAR to authenticate when contacting an 
    AA, and it must therefore be given a key and an SSL client certificate. It 
    is permissible for the SHAR to use the same keypair and certificate used by 
    the target web server itself, provided the certificate is signed by a CA 
    accepted by the origin sites that will be queried for attributes.</p>
    <p>On Unix, we require that OpenSSL be installed to use Shibboleth. On 
    Windows, OpenSSL libraries and the command line tool are included in the 
    package and can be used directly, if not otherwise available. Certain
    commands require the <span class="fixed">openssl.cnf</span> configuration
    file, an example of which is included with the Windows installation in
    <span class="fixed">C:\opt\shibboleth\etc\shibboleth\openssl.cnf</span>.
    To locate this file for a command that requires it, add the
    <span class="fixed">-config C:\opt\shibboleth\etc\shibboleth\openssl.cnf</span>
    parameter to the command.</p>
    <p>The certificate and key file location should be based on whether they 
    will also be used for Apache. If they will be used as a server key pair 
    as well, they should probably be in the Apache tree in the usual
    <span class="fixed">mod_ssl</span>-defined locations inside the Apache 
    configuration folder, and the SHAR can read them from there. If the SHAR is 
    not running as <span class="fixed">root</span>, permissions might need to be 
    changed to allow this access. If the certificate and key will only be used 
    for the SHAR, they can be put in the same folder with the
    <span class="fixed">shibboleth.xml</span> file and protected appropriately.</p>
    <p>Other web servers like IIS do not use the file formats that Apache and 
    Shibboleth can share, and therefore the components must generally use 
    separate copies of the key and certificate if they are to be shared. Most 
    other servers can export and/or import keys to and from PEM or DER format.
    Refer to your server&#39;s documentation or ask for assistance from others
    who use it.</p>
    <p>The SHAR is assigned a key and a certificate using shibboleth.xml&#39;s
    <a href="#confFileResolver"><span class="fixed">FileResolver</span></a> element
    described in <a href="#4.a.">section 4.a.</a> Various formats are supported and
    OpenSSL can generate and convert among them. OpenSSL commands to generate a new
    keypair and a certificate request are shown here, assuming 2048 bit RSA keys are
    to be used:</p>
    <blockquote>
        <p><span class="fixed">$ openssl genrsa -out ssl.key 2048<br>
        $ openssl req -new -key ssl.key -out ssl.csr</span> </p>
    </blockquote>
    <p>The signed certificate file returned by the CA should be usable directly.</p>
    <p>If the key is to be shared with Apache, the web server&#39;s child processes, 
    often running as <span class="fixed">nobody</span> or a similar uid, must be
    able to read them while the server is running, which may require permission
    changes.</p>
    <p>This particularly applies when sharing the key and certificate used by 
    mod_ssl, which are only readable by root by default. The password, if any, 
    must be placed in the <span class="fixed">shibboleth.xml</span> file, since 
    the Apache module cannot prompt for it during initial startup as mod_ssl 
    can. The issues surrounding how to securely obtain a key while running as
    <span class="fixed">nobody</span> may be addressed in a later release. Since 
    the password will be stored in clear text in a frequently examined file, it 
    is suggested to use a password not used elsewhere, or preferably not to use
    a password at all.</p>

</blockquote>
<h4><a name="4.d."></a>4.d. Protecting Web Pages</h4>
<blockquote>
    <p>Protection of web pages is primarily achieved through &quot;mapping&quot;
    attributes provided by an AA to a localized vocabulary for authorization
    rules. This is accomplished using features in the AAP syntax, described in
    <a href="#4.e.">section 4.e.</a> This applies to both Apache and IIS.</p>
    <p><b><u>IIS</u></b></p>
    <p>The IIS filter module supports the mapping of attributes into HTTP headers
    via AAP files, but it does not yet support rule-based access control and
    therefore cannot protect static content at this time. In addition, all of
    the configuration settings, such as control over whether to prompt for new
    sessions automatically, are managed via the
    <a href="#confRequestMap"><span class="fixed">RequestMap</span></a> element,
    so there are no additional commands to document at this time.<br>
    </p>
    <p><b><u>Apache</u></b></p>
    <p>The Apache module provided can also interpret AAP settings to map
    attributes to HTTP request headers and to <span class="fixed">Require</span>
    rules, permitting protection of both static and dynamic content. Any of the
    typical ways of protecting content may be used (.htaccess, Directory,
    Location, Files, etc.). They define what content is to be protected and
    static access control rules.</p>
    <p>There are two ways to require Shibboleth authentication, but both also require
    enabling the module to activate by specifying an <span class="fixed">AuthType</span>
    of <span class="fixed">shibboleth</span> and supplying at least one
    <span class="fixed">Require</span> rule in <span class="fixed">httpd.conf</span>
    or <span class="fixed">.htaccess</span> files. The <span class="fixed">Require</span>
    rule can enforce a specific access control policy based on attributes, can specify
    <span class="fixed">valid-user</span> to require any authenticated session, or it can
    support so-called lazy sessions by using the place-holder rule name of
    <span class="fixed">Shibboleth</span>. In such cases, the module is activated, but
    in a passive mode that does not automatically force a session, but will process
    and validate a session if one exists, leaving the authorization decision to the
    application. Using a static access control rule that will fail in the absence of
    a session is only sensible if one of the two approaches below that force a session
    are used.</p>
    <p>To require a session, either the Apache command, <span class="fixed">ShibRequireSession On</span>,
    or the <span class="fixed">requireSession</span> boolean XML attribute on the
    <a href="#confRequestMap"><span class="fixed">RequestMap</span></a>,
    <a href="#confHost"><span class="fixed">Host</span></a>, or
    <a href="#confPath"><span class="fixed">Path</span></a> elements in
    <span class="fixed">shibboleth.xml</span> can be used. Both approaches are equivalent, and
    using either one to require a session will supersede a false or absent setting of the other type.</p>
    <p>As an example, the following commands will require Shibboleth authentication for a resource:</p>
    <blockquote>
        <span class="fixed">AuthType shibboleth<br>
        ShibRequireSession On<br>
        Require valid-user</span>
    </blockquote>
    <p>A complete list of Apache directives and their values is below:</p>
    <dl>
        <dd class="attribute"><span class="fixed">ShibURLScheme &lt;http/https&gt;</span></dd>
        <dd class="value">Used in advanced virtual hosting environments which need to generate
        SSL redirects from virtual servers that use only HTTP. Supplements the
        Apache <span class="fixed">ServerName</span> and <span class="fixed">Port</span>
        commands with this missing option. Defaults to a null value in which the scheme
        for redirects is based on the physical connection to the server. This is a server-level
        command, while the rest of the commands listed are content commands that can appear
        anywhere.</dd>
        <dd class="attribute"><span class="fixed">AuthType &lt;string&gt;</span></dd>
        <dd class="value">Use <span class="fixed">shibboleth</span> for direct 
        invocation, or <span class="fixed">Basic</span> plus the
        <span class="fixed">ShibBasicHijack</span> option described below.</dd>
        <dd class="attribute"><span class="fixed">ShibBasicHijack &lt;on/off&gt;</span></dd>
        <dd class="value">Controls whether Shibboleth should or should not 
        ignore requests with <span class="fixed">AuthType Basic</span>. Defaults 
        to <span class="fixed">off</span>.</dd>
        <dd class="attribute"><span class="fixed">ShibRequireSession &lt;on/off&gt;</span></dd>
        <dd class="value">Controls whether to require an authenticated session before passing
        control to the authorization phase or the actual resource. Defaults to
        <span class="fixed">off</span>.</dd>
        <dd class="attribute"><span class="fixed">ShibExportAssertion &lt;on/off&gt;</span></dd>
        <dd class="value">Controls whether the SAML attribute assertion provided 
        by the AA is exported in a base64-encoded HTTP header,
        <span class="fixed">HTTP_SHIB_ATTRIBUTES</span>. Defaults to <span class="fixed">off</span>.</dd>
        <dd class="attribute"><span class="fixed">ShibRequireAll &lt;on/off&gt;</span></dd>
        <dd class="value">Controls whether all <span class="fixed">Require</span> rules
        specified must be satisfied before access to the resource is granted. Defaults to
        <span class="fixed">off</span>, which means any single rule can be satisfied, the
        usual Apache behavior.</dd>
        <dd class="attribute"><span class="fixed">AuthGroupFile &lt;pathname&gt;</span></dd>
        <dd class="value">Same as mod_auth; collects values found in REMOTE_USER 
        into a named group for access control. An attribute must be mapped to 
        REMOTE_USER for this to work. Note that mod_auth will not support group 
        files when the Shibboleth module is loaded, since they share the same command.
        <p><a href="http://httpd.apache.org/docs/mod/core.html#require">This is 
        implemented</a> by placing a <span class="fixed">.htaccess</span> file 
        that references a group file stored at <span class="fixed">/pathname</span>:</p>
        <blockquote>
            <p><span class="fixed">AuthGroupFile /pathname<br>
            require group workgroup</span></p>
        </blockquote>
        <p>An
        <a href="http://httpd.apache.org/docs/mod/mod_auth.html#authgroupfile">
        AuthGroupFile</a> used by Shibboleth might resemble:<br>
        <span class="fixed">workgroup: joe@example.edu, jane@demo.edu, jim@sample.edu</span>
        </dd>
        <dd class="attribute"><span class="fixed">Require &lt;string&gt;</span></dd>
        <dd class="value">Enforce authorization using one of the following methods.
        <ul type="circle">
            <li><span class="fixed">valid-user</span><blockquote>
                <p>Any Shibboleth user from a trusted origin site is accepted, 
                even if no actual attributes are received. This is a very 
                minimal kind of policy, but is useful for testing or for 
                deferring real policy to an application.</p>
            </blockquote>
            </li>
            <li><span class="fixed">user</span><blockquote>
                <p>A space-delimited list of values, such as from the
                <span class="fixed">urn:mace:dir:attribute-def:eduPersonPrincipalName</span> 
                attribute. Actually, any attribute can be mapped to REMOTE_USER, 
                even if this doesn&#39;t always make sense.</p>
            </blockquote>
            </li>
            <li><span class="fixed">group</span><blockquote>
                <p>A space-delimited list of group names defined within
                <span class="fixed">AuthGroupFile</span> files, again provided 
                that a mapping to <span class="fixed">REMOTE_USER</span> exists.</p>
            </blockquote>
            </li>
            <li><span class="fixed"><i>alias</i></span><blockquote>
                <p>An arbitrary rule name that matches an Alias defined in an 
                AAP file. The rule value is a space-delimited list of attribute 
                values, whose format depends on the attribute in question (e.g. 
                an affiliation rule might look like:</p>
                <p><span class="fixed">require affiliation staff@osu.edu faculty@mit.edu</span></p>
            </blockquote>
            </li>
            <li><span class="fixed">shibboleth</span><blockquote>
                <p>If a session cookie of the expected name exists, the corresponding
                session will be validated and any cached attributes exported as otherwise
                specified. Authorization will be controlled by the resource, unless
                additional rules are specified. If however a session does not already
                exist, or if the current session expires or times out, no session will
                be requested and control will pass to the resource.</p>
            </blockquote>
            </li>
        </ul>
        <p>Additionally, for <span class="fixed">user</span> and
        <span class="fixed">&lt;alias&gt;</span>-based rules, if a tilde character is 
        placed immediately following <span class="fixed">user</span> or
        <span class="fixed">&lt;alias&gt;</span>, the expressions that follow are 
        treated as regular expressions. The syntax supported is generally based 
        on the one defined by <a href="http://www.w3.org/TR/xmlschema-2/#regexs">
        XML Schema</a>. This specification borders on unreadable, but the syntax 
        is generally Perl-like. Expressions should generally be &quot;anchored&quot; with 
        the ^ and $ symbols to insure mid-string matches don&#39;t cause false 
        positives.</p>
        <p>For example, the rule:<br>
&nbsp;&nbsp;&nbsp; <span class="fixed">require affiliation ~ ^member@.+\.edu$<br>
        </span>would evaluate to allowing anyone with an <span class="fixed">
        affiliation</span> of <span class="fixed">member</span> from a .edu 
        domain.</dd>
    </dl>
</blockquote>
<h4><a name="4.e."></a>4.e. Defining Attributes and Acceptance Policies</h4>
<blockquote>
    <p>Shibboleth allows a user and a site to release a varying set of 
    attributes to a destination site, and does not impose restrictions on the 
    kinds of attribute information provided by an AA. Target implementations 
    must be prepared to examine the attributes they receive and filter them 
    based on policies about what information to permit an origin site to assert 
    about its users.</p>
    <p>Attribute acceptance is the process of defining acceptable attributes and 
    filtering attribute values before passing them on to a resource manager, 
    such as the Shibboleth module or a web application. Data blocked by 
    AAP filters will not be passed to the CGI environment or used when enforcing
    <span class="fixed">.htaccess</span> rules in Apache. Note that the attribute 
    assertion exported to the <span class="fixed">HTTP_SHIB_ATTRIBUTES</span> header 
    is now also filtered. This is a change from previous versions. To compensate,
    either no AAP can be specified, or a rule can be applied to permit all
    attributes to pass through while also exporting specific attributes.</p>
    <p>The Shibboleth implementation supports Scoped and Simple attributes and 
    filtering policies for different kinds of attributes, and is potentially 
    extensible to more complex attributes in the future. An attribute is 
    considered Scoped if the XML representation of its values contains a &quot;Scope&quot; 
    attribute. As of 1.1+, this is detected at runtime and requires no 
    configuration in advance.</p>
    <p><b>An essential part of the Shibboleth trust fabric is ensuring that 
    sites only assert attributes for domains for which they are considered 
    authoritative by the target. Typically, this means that Brown University 
    will be trusted to assert attributes only scoped to <span class="fixed">
    brown.edu</span>. Unless there are very specific circumstances requiring 
    this restriction be removed, it is strongly encouraged that such policies be 
    left in place.</b></p>
    <h4>Scoped:</h4>
    <blockquote>
        <p>Scoped attributes are a special kind of attribute whose values are a 
        combination of a <span class="fixed">value</span> and a
        <span class="fixed">scope</span>, or <span class="fixed">context</span> 
        for the value. An example is <span class="fixed">
        eduPersonScopedAffiliation</span>, which adds a scope to the defined set 
        of <span class="fixed">eduPersonAffiliation</span> values, such as
        <span class="fixed">student</span>, <span class="fixed">member</span>, 
        or <span class="fixed">faculty</span>. Scopes are expressed as DNS 
        domains and subdomains as a convention.</p>
        <p>Any <span class="fixed">scoped</span> attribute can be scoped only to 
        the origin site&#39;s permitted domains. These domains are listed in the 
        operational metadata that provides policy information to the system and
        can be overridden or supplemented using the AAP. Domains can be explicit
        or regular expressions, and can be changed by a target to meet its needs.
        Thus, attribute acceptance processing for <span class="fixed">scoped</span>
        attributes is based on site metadata and target-specified overrides in
        addition to the mechanism described below for <span class="fixed">simple</span>
        attributes.</p>
        <p>Scope rules specified in an AAP are additive with any domains 
        permitted by site metadata, and the rules are applied by first looking 
        for an applicable denial rule, and then looking at site metadata and any 
        applicable site rules for an accept rule.</p>
    </blockquote>
    <h4>Simple:</h4>
    <blockquote>
        <p>Simple attributes are attributes whose value is expressed in XML as a 
        Text node; that is, the value is just a string. Multiple values are 
        permitted. <span class="fixed">eduPersonEntitlement</span>, in which the 
        values are URIs, is one example of a simple attribute.</p>
        <p>Both Simple and Scoped attribute acceptance is controlled with an 
        external (or in 1.2, optionally inline) policy file written in XML.
        The schema for the file is described by the <span class="fixed">shibboleth.xsd</span>
        schema, and an example file is included, <span class="fixed">AAP.xml</span>.
        It is now optional to supply such a policy, but in the absence of one, no
        attributes will be exported into request headers, and the option to export
        the assertion as a whole must be used instead.</p>
        <p>The policy is a default-deny algorithm that requires permissible 
        attributes and values be listed explicitly. That is, an empty (as opposed to no)
        policy permits nothing. Each attribute to be supported must be listed in the 
        policy by name in an <span class="fixed">&lt;AttributeRule&gt;</span>. Each such 
        rule is a collection of <span class="fixed">&lt;SiteRule&gt;</span> elements 
        along with an optional <span class="fixed">&lt;AnySite&gt;</span> default 
        rule. In turn each site rule is a set of <span class="fixed">&lt;Value&gt;</span> 
        rules that specify matches to permit, either literal or regular 
        expressions, or a wildcarded <span class="fixed">&lt;AnyValue&gt;</span> 
        default rule, which is equivalent to a single regular expression rule 
        allowing anything.</p>
        <p>With 1.2, a new <span class="fixed">&lt;AnyAttribute&gt;</span> element
        can be used before or in place of the <span class="fixed">&lt;AttributeRule&gt;</span>
        elements to allow all attributes and values to pass muster. The purpose of this
        is to then supply rules to specify the export of particular attributes, without
        using those rules to control acceptance.</p>
    </blockquote>
    <p>A syntax summary follows:</p>
    <blockquote>
        <p><span class="fixed">&lt;AttributeAcceptancePolicy&gt;</span></p>
        <blockquote>
            <p>The top level element in the file.</p>
        </blockquote>
        <p><span class="fixed">&lt;AnyAttribute&gt;</span></p>
        <blockquote>
            <p>Disables acceptance filtering and leaves the assertion intact.</p>
        </blockquote>
        <p><span class="fixed">&lt;AttributeRule&gt;<br>
&nbsp;&nbsp;&nbsp; Name=&quot;urn:mace:dir:attribute-def:eduPersonScopedAffiliation&quot;<br>
&nbsp;&nbsp;&nbsp; Header=&quot;Shib-EP-Affiliation&quot; Alias=&quot;affiliation&quot;&gt;</span></p>
        <blockquote>
            <p>Specifies a rule for an attribute, named by its URI. The 
            following XML attributes can be supplied:</p>
            <table border="1" cellpadding="5" cellspacing="5">
                <tr>
                    <td><span class="fixed">Name</span></td>
                    <td>The name of the Shibboleth attribute, usually a URI. 
                    This is the only required XML attribute.</td>
                </tr>
                <tr>
                    <td><span class="fixed">Namespace</span></td>
                    <td>If the attribute&#39;s name includes a SAML namespace, 
                    supply it here. Normally this is unused.</td>
                </tr>
                <tr>
                    <td><span class="fixed">Header</span></td>
                    <td>The HTTP request header to map the attribute&#39;s values 
                    into.</td>
                </tr>
                <tr>
                    <td><span class="fixed">Alias</span></td>
                    <td>A short name for the attribute, determines the name of 
                    the Apache <span class="fixed">Require</span> rule.</td>
                </tr>
            </table>
        </blockquote>
        <p><span class="fixed">&lt;AnySite&gt;</span></p>
        <blockquote>
            <p>Specifies a rule that always applies to the attribute, regardless 
            of the asserting origin site.</p>
        </blockquote>
        <p><span class="fixed">&lt;SiteRule Name=&quot;providerId&quot;&gt;</span></p>
        <blockquote>
            <p>A rule that applies to the origin site corresponding to the supplied
            identifier</p>
        </blockquote>
        <p><span class="fixed">&lt;Scope Accept=&quot;true|false&quot; Type=&quot;type&quot;&gt;</span></p>
        <blockquote>
            <p>Specifies a value to accept or deny, either directly using
            <span class="fixed">type</span> <span class="fixed">literal</span>, 
            or using a set of matching expressions as <span class="fixed">type</span>
            <span class="fixed">regexp</span>. <span class="fixed">literal</span> 
            is the default if <span class="fixed">Type</span> is not specified. 
            Accept defaults to &quot;true&quot;&gt;.</p>
        </blockquote>
        <p><span class="fixed">&lt;AnyValue&gt;</span></p>
        <blockquote>
            <p>Specifies a rule that always applies to the attribute and site, 
            regardless of the value(s).</p>
        </blockquote>
        <p><span class="fixed">&lt;Value Type=&quot;type&quot;&gt;</span></p>
        <blockquote>
            <p>Specifies a value to permit, either directly using
            <span class="fixed">type</span> <span class="fixed">literal</span>, 
            or using a set of matching expressions as <span class="fixed">type</span>
            <span class="fixed">regexp</span>. <span class="fixed">literal</span> 
            is the default if <span class="fixed">Type</span> is not specified.</p>
        </blockquote>
    </blockquote>
    <p>The regular expression syntax is a subset of the usual Perl and Unix 
    syntaxes that is described in the XML Schema specification by the W3C. Most 
    typical expressions should work. Be sure to anchor them using
    <span class="fixed">^</span> and <span class="fixed">$</span> to avoid 
    unintentional matches midstring.</p>
</blockquote>
<h4><a name="4.f."></a>4.f. Using Attributes and Session Data in Applications</h4>
<blockquote>
    <p>Apart from the simple RM functionality provided, attribute information 
    may be made available directly to applications via the standard practice of 
    creating custom HTTP request headers before passing control to the 
    resource. Web applications should make no assumption about the presence of 
    specific attributes for their use unless they have intimate knowledge of the 
    attribute release policies in place.</p>
    <p>The AAP rules control this interface, and map Shibboleth attributes
    to header names, such as <span class="fixed">Shib-EP-Affiliation</span>. 
    Using that example, any values of the mapped attribute will be placed in 
    that header, delimited by semicolons. An application that uses a CGI-like 
    syntax to access the header will find the values in the <span class="fixed">
    HTTP_SHIB_EP_AFFILIATION</span> variable. Any attribute can be placed in any 
    header, to drive legacy applications that expect information in a particular 
    location.</p>
    <p>The <span class="fixed">REMOTE_USER</span> variable is a special case 
    that is generally populated automatically by the web server based on an 
    internal piece of data that represents the current <span class="fixed">
    username</span>. Unlike many authentication modules, Shibboleth does not 
    guarantee that <span class="fixed">REMOTE_USER</span> will have any value, 
    because users may remain anonymous in many cases. If it does have a value, 
    it is set solely because of an AAP file that maps an attribute to that 
    header name. For many purposes, the <span class="fixed">
    urn:mace:dir:attribute-def:eduPersonPrincipalName</span> attribute should be 
    mapped to <span class="fixed">REMOTE_USER</span>. Even so, EPPN may not be 
    provided by the AA, and <span class="fixed">REMOTE_USER</span> might still 
    be empty.</p>
    <p>In addition to general attribute information, the following special
    HTTP headers are created for any authenticated request:</p>
    <dl>
        <dd class="attribute"><span class="fixed">HTTP_SHIB_ORIGIN_SITE</span></dd>
        <dd class="value">Contains the unique identifier (providerId) of the
        origin site of the user. Some applications may use this to lookup
        additional policy or application data. It normally takes the form of a
        URI but could be any string in some deployments.</dd>
        <dd class="attribute"><span class="fixed">HTTP_SHIB-AUTHENTICATION-METHOD</span></dd>
        <dd class="value">Contains the SAML AuthenticationMethod URI that
        documents some aspect of the user's authentication to the origin site's
        web authentication service.</dd>
        <dd class="attribute"><span class="fixed">HTTP_SHIB_APPLICATION_ID</span></dd>
        <dd class="value">Contains the XML <span class="fixed">applicationId</span>
        attribute in <span class="fixed">shibboleth.xml</span> that corresponds to
        the request based on the <a href="#confRequestMap"><span class="fixed">RequestMap</span></a>
        and associated elements.</dd>
        <dd class="attribute"><span class="fixed">HTTP_SHIB_ATTRIBUTES</span></dd>
        <dd class="value">Contains the assertion in XML containing the
        SAML attribute information from the AA in base64-encoded format.
        This is a raw interface that provides an application with the entire 
        assertion in, but is still a filtered view based on any attribute acceptance
        rules.</dd>
    </dl>
    <p>Finally, special support exists to obtain the value of the SAML
    <span class="fixed">&lt;NameIdentifier&gt;</span> element, which identifies the
    subject of the session, the user. Many Shibboleth deployments use opaque handles
    that have no application value, however newer deployments may choose to support
    alternative identifiers, including formats defined by SAML. Targets can use
    these origins and obtain the primary subject name by using a special AAP
    <span class="fixed">&lt;AttributeRule&gt;</span> with a
    <span class="fixed">Name</span> corresponding to the SAML
    <span class="fixed">Format</span> identifier that describes the kind of
    identifier used to represent the subject. The rule specifies in what header
    to export the identifier value (such as <span class="fixed">REMOTE_USER</span>),
    while the <span class="fixed">Format</span> identifier will be placed in the
     <span class="fixed">HTTP_SHIB_NAMEIDENTIFIER_FORMAT</span> header.
    </p>
</blockquote>
<h4><a name="4.g."></a>4.g. <span class="fixed">siterefresh</span></h4>
<blockquote>
    <p>Shibboleth provides a simple tool called <span class="fixed">siterefresh</span> 
    in the <span class="fixed">/opt/shibboleth/bin</span> folder of the 
    distribution to maintain metadata files referenced by <span class="fixed">
    shibboleth.xml</span>. It will return 0 only on success and a negative number on 
    failure and log errors to <span class="fixed">stderr</span>. If the data in 
    the new metadata file is unusable or schema invalid, or the signature is invalid,
    the existing copy is kept and not overwritten. The SHAR and SHIRE stat all
    metadata files each time the data is used, allowing them to detect and utilize
    updates in real-time during system operation.</p>
    <p><span class="fixed">siterefresh</span> takes the following command-line 
    parameters:</p>
    <dl>
        <dd class="attribute"><span class="fixed">--url &lt;URL&gt;</span></dd>
        <dd class="value">Specifies the <span class="fixed">URL</span> of the 
        remote metadata file with which to update the local file. HTTPS is not
        supported at this time.</dd>
        <dd class="attribute"><span class="fixed">--out &lt;pathname&gt;</span></dd>
        <dd class="value">Specifies the local file to which to write the new 
        metadata.</dd>
        <dd class="attributeopt"><span class="fixed">--noverify</span></dd>
        <dd class="value">Explicitly disables the requirement for the file to be signed
        and allows the certificate parameter to be ommitted. If the file is signed,
        the signature will be verified using whatever key is supplied inside it,
        and an invalid signature will still result in an error, but if the file is
        unsigned or has a valid signature, only a warning will be logged, and the
        result will be success.</dd>
        <dd class="attributeopt"><span class="fixed">--cert &lt;pathname&gt;</span></dd>
        <dd class="value">Specifies the location of a certificate stored in
        <span class="fixed">PEM</span> format used to validate the signature of 
        the metadata file. Since much of Shibboleth&#39;s security flows from 
        metadata files, this option is highly recommended, and the certificate 
        used should be verified independently in some out of band fashion.</dd>
        <dd class="attributeopt"><span class="fixed">--schema &lt;pathname&gt;</span></dd>
        <dd class="value">Optionally defines a base path for schemas to use 
        when validating the file. Defaults to a location based on the installation
        path on Unix, or <span class="fixed">\opt\shibboleth\etc\shibboleth</span>
        on Windows.</dd>
        <dd class="attributeopt"><span class="fixed">--rootns &lt;XML namespace&gt;</span></dd>
        <dd class="value">Optionally defines the XML namespace of the root element
        expected in the new file. Normally unused, provided to support alternative
        metadata formats that may be backported to older releases.</dd>
        <dd class="attributeopt"><span class="fixed">--rootname &lt;XML element name&gt;</span></dd>
        <dd class="value">Optionally defines the name of the root element
        expected in the new file. Normally unused, provided to support alternative
        metadata formats that may be backported to older releases.</dd>
    </dl>
    <p>If a zero is returned, the command will copy the retrieved file to the output
    location. Otherwise one of the following error values will be returned:</p>
    <table align="center" cellspacing="5">
        <tr><td>-100</td><td>an invalid combination of parameters was specified</td></tr>
        <tr><td>-10</td><td>the OpenSAML library failed to initialize</td></tr>
        <tr><td>-1</td><td>the file's XML digital signature was invalid</td></tr>
        <tr><td>-2</td><td>a SAML exception was trapped</td></tr>
        <tr><td>-3</td><td>an XML library exception was trapped</td></tr>
        <tr><td>-4</td><td>a general XML security library exception was trapped</td></tr>
        <tr><td>-5</td><td>an XML security library crypto exception was trapped</td></tr>
        <tr><td>-6</td><td>an unknown exception was trapped</td></tr>
    </table>
    <p>A complete command issued to <span class="fixed">siterefresh</span> might 
    take the form:</p>
    <blockquote>
        <p><span class="fixed">/opt/shibboleth/bin/siterefresh --out IQ-sites.xml --cert internet2.pem \<br>
        --url http://wayf.internet2.edu/InQueue/IQ-sites.xml </span></p>
    </blockquote>
    <p>It is recommended that such commands be added to a <span class="fixed">
    crontab</span> to keep the site and trust files refreshed. AAP files tend to 
    be site-specific, but could be maintained and distributed centrally. If the 
    command is invoked in a script that writes the file to a new location and 
    compares it with the old contents before overwriting the original, the 
    command could be run very often without impacting target operations, 
    providing a high degree of currency in case sites become compromised.</p>
</blockquote>
<h4><a name="4.h."></a>4.h. MySQL Session Cache</h4>
<blockquote>
    <p>Shibboleth includes a useful plugin that extends the default memory cache 
    for storing session data in the SHAR with a backing cache using an embedded 
    MySQL database. It is now disabled by default. The plugin can be found in the
    <span class="fixed">/opt/shibboleth/libexec</span> folder, and is loaded as an
    extension library using the <a href="#confExtensions"><span class="fixed">Extensions</span></a>
    element of <span class="fixed">shibboleth.xml</span>. The extension and the
    <a href="#confMySQLSessionCache"><span class="fixed">MySQLSessionCache</span></a>
    element are commented out by default.</p>
    <p>Important <a href="#confArgument"><span class="fixed">Argument</span></a>
    elements you'll find by default include:</p>
        <blockquote class="fixed">
            <p>--language=/opt/shibboleth/share/english<br>
            --datadir=/opt/shibboleth/data</p>
        </blockquote>
        <p>which set the message file path and the location of the cache's 
        database files respectively. Make sure the data directory exists before 
        starting the SHAR if you change this path.</p>
</blockquote>
<h4><a name="4.i."></a>4.i. Using Lazy Sessions</h4>
<blockquote>
    <p><b>For a background on sessions in Shibboleth, and a description of what
    a lazy session is and why it would be useful, consult <a href="#1.g">section
    1.g</a>.</b></p>
    <p>This section describes how an application can trigger the establishment
    of a Shibboleth session and optionally receive attributes once its internal
    logic decides this is necessary.  It assumes the application is protected
    using lazy sessions because the <span class="fixed">RequireSession</span>
    attribute of the <a href="#confPath"><span class="fixed">Path</span></a> or
    <a href="#confPath"><span class="fixed">Host</span></a> element protecting
    it is set to <span class="fixed">false</span>.  This application must be
    aware of two pieces of information:</p>
    <ul>
      <li>The URL that should be accessed after the session is established;
      frequently, this will be the application's own URL; and</li>
      <li>The URL of the SHIRE associated with the <a
      href="#confApplication"><span class="fixed">Application</span></a>
      containing the URL to be accessed(contained within the corresponding <a
      href="#confSessions"><span class="fixed">Sessions</span></a>
      element).</li>
    </ul>
    <p>These two pieces of information must be combined by the application to an
    appropriately formed URL to trigger session initiation as follows.  To
    request a session, the application returns an HTTP redirect that sends the
    browser to the SHIRE URL with a parameter, <span
    class="fixed">target</span>, containing the URL of the resource to return to
    with a session.  This will often be the URL that's triggering the redirect. 
    The SHIRE will generate the redirect to the WAYF and the rest proceeds as a
    standard Shibboleth flow.  This combined URL takes the form: <span class="fixed">https://<i>shireURL</i>?target=<i>applicationURL</i></span>.</p>
    <p>For example, if an application located at <span
    class="fixed">https://foo.com/portal</span> presents a page with an option
    to login, it could respond to the login button by redirecting the browser to
    <span
    class="fixed">https://foo.com/Shibboleth.shire?target=https%3A%2F%2Ffoo.com%2Fportal</span>.</p>

</blockquote>
<hr>
<h3><a name="5."></a>5. Troubleshooting</h3>
<p>This section provides basic information about testing Shibboleth targets. 
This information is not intended to be comprehensive, but instead rudimentary 
guidelines for basic configuration tests and problems. For more detailed 
information or answers to specific problems not addressed in this section, 
please mail <a href="mailto:shibboleth-users@internet2.edu">shibboleth-users@internet2.edu</a>
with a thorough description of errors and configurations used.</p>
<h4><a name="5.a."></a>5.a. Basic Testing</h4>
<blockquote>
    <p>The target may be tested by generating a folder with very basic access 
    controls on it, and accessing it using a web browser. Place a simple webpage 
    such as <span class="fixed">index.html</span> in <span class="fixed">
    /secure/</span>. Then, add the following lines to <span class="fixed">
    httpd.conf</span>, which should be removed when testing is over:</p>
    <blockquote>
        <p><span class="fixed"># Configure a test directory<br>
        &lt;Location /secure&gt;<br>
        &nbsp;&nbsp;AuthType shibboleth<br>
        &nbsp;&nbsp;ShibRequireSession On<br>
        &nbsp;&nbsp;require valid-user<br>
        &lt;/Location&gt;<br>
        </span></p>
    </blockquote>
    <p><b>For information regarding specific error messages that may be 
    generated if the target does not work successfully, please refer to section
    <a href="#5.b.">5.b.</a>, or write
    <a href="mailto:shibboleth-users@internet2.edu">shibboleth-users@internet2.edu</a>.</b></p>
</blockquote>
<h4><a name="5.b."></a>5.b. Common Problems</h4>
<blockquote>
    <p>A knowledge base is being developed in the
    <a href="https://umdrive.memphis.edu/wassa/public/shib.faq/shibboleth-faq.html">
    Shibboleth Deployer&#39;s FAQ</a>. Please mail
    <a href="mailto:shibboleth-users@internet2.edu">shibboleth-users@internet2.edu</a> 
    with any additional questions or problems encountered that are not answered 
    by this basic guide.</p>
</blockquote>

</body>

</html>
